<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo Interactivo: Protocolos de Seguridad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos generales y espec√≠ficos */
        body { font-family: 'Inter', sans-serif; } /* Usar fuente Inter si est√° disponible */
        .module-content { display: none; }
        .step-content { display: none; }
        .step-content.active { display: block; }
        .scenario-content { display: none; }
        .scenario-content.active { display: block; }
        .feedback { display: none; margin-top: 1rem; padding: 0.75rem; border-radius: 0.375rem; font-size: 0.9rem; }
        .feedback.correct { background-color: #d1fae5; border: 1px solid #065f46; color: #065f46; } /* Tailwind green-100, green-700 */
        .feedback.incorrect { background-color: #fee2e2; border: 1px solid #991b1b; color: #991b1b; } /* Tailwind red-100, red-700 */
        .option-button {
            display: block;
            width: 100%;
            text-align: left;
            margin-top: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem;
            background-color: #ffffff; /* white */
            transition: background-color 0.2s, border-color 0.2s;
            cursor: pointer;
        }
        .option-button:hover:not(:disabled) {
            background-color: #f3f4f6; /* gray-100 */
        }
         .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .option-button.selected {
             border-color: #3b82f6; /* blue-500 */
             background-color: #eff6ff; /* blue-50 */
             font-weight: 600;
        }
         .option-button.correct-answer {
             border-color: #10b981; /* emerald-500 */
             background-color: #ecfdf5; /* emerald-50 */
         }
         .option-button.incorrect-answer {
             border-color: #f87171; /* red-400 */
             background-color: #fef2f2; /* red-50 */
         }
         /* Estilo para las fichas del men√∫ principal */
         .menu-card {
             display: flex;
             flex-direction: column;
             align-items: center;
             padding: 1.5rem; /* Aumentar padding */
             margin-bottom: 1rem;
             border: 1px solid #e5e7eb; /* gray-200 */
             border-radius: 0.75rem; /* M√°s redondeado */
             background-color: #f9fafb; /* gray-50 */
             text-align: center;
             cursor: pointer;
             transition: background-color 0.2s, box-shadow 0.3s, transform 0.2s;
             height: 100%; /* Asegurar altura uniforme en grid */
         }
         .menu-card:hover {
             background-color: #ffffff; /* white */
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Sombra sutil */
             transform: translateY(-2px); /* Efecto levantar */
         }
         .menu-card-icon {
             font-size: 3rem; /* Icono m√°s grande */
             margin-bottom: 1rem;
             color: #4b5563; /* gray-600 */
         }
         .menu-card-title {
             font-weight: 700; /* M√°s bold */
             color: #111827; /* gray-900 */
             font-size: 1.1rem; /* Ligeramente m√°s grande */
             margin-bottom: 0.25rem;
         }
         .menu-card-subtitle {
             font-size: 0.9rem;
             color: #6b7280; /* gray-500 */
         }
         /* Ajuste para listas dentro de pasos */
         .step-content ul { padding-left: 1.5rem; } /* A√±ade indentaci√≥n a las listas */
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div id="app-container" class="max-w-5xl mx-auto bg-white rounded-lg shadow-xl p-6 md:p-10"> <div id="main-menu" class="text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">Centro de Entrenamiento Interactivo</h1>
            <h2 class="text-xl md:text-2xl font-semibold text-blue-700 mb-8">Protocolos de Seguridad F√≠sica (Res. 01675)</h2>
            <p class="text-gray-600 mb-6">Selecciona el protocolo que deseas practicar:</p>
            <div id="menu-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
        </div>

        <div id="active-module" class="module-content">
             <button onclick="goToMainMenu()" class="absolute top-4 right-4 md:top-6 md:right-6 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-semibold py-1 px-3 rounded-full transition duration-200 z-10">
                &larr; Volver al Men√∫
            </button>
            <h1 id="module-title" class="text-2xl md:text-3xl font-bold text-gray-800 mb-1 pt-8 md:pt-0"></h1> <h2 id="module-subtitle" class="text-lg md:text-xl font-semibold text-blue-700 mb-6"></h2>

            <div id="protocolo" style="display: none;">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Repaso del Protocolo</h3>
                <div id="protocol-steps-container">
                    </div>
                <div id="verification-question" style="display: none;" class="mt-6 p-4 border rounded-lg bg-blue-50">
                     <h4 class="font-bold text-lg mb-3 text-blue-800">¬°Verifica tu Comprensi√≥n!</h4>
                     <p id="verification-question-text" class="mb-3 text-gray-700"></p>
                     <div id="verification-options-container">
                         </div>
                     <div id="verification-feedback" class="feedback"></div>
                     <div class="mt-4 text-center">
                        <button id="start-scenarios-btn" onclick="startScenarios()" style="display:none;" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                            Iniciar Escenarios Simulados
                        </button>
                     </div>
                </div>
            </div>

            <div id="escenarios" style="display: none;">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Escenarios Simulados</h3>
                <div id="scenarios-container">
                    </div>
            </div>

            <div id="resumen" style="display: none;" class="p-6 border rounded-lg bg-blue-50">
                <h3 class="text-xl font-semibold text-blue-700 mb-4">Resumen del M√≥dulo</h3>
                 <div id="summary-icon" class="flex justify-center space-x-4 my-4 text-3xl text-green-600">
                    <span>&#127941;</span> <span>&#128206;</span> <span>&#128170;</span>
                 </div>
                <p class="text-gray-700 mb-4">¬°Felicidades por completar el m√≥dulo!</p>
                <p class="font-semibold mb-2 text-gray-800">Puntos Clave Recordados:</p>
                <ul id="summary-points" class="list-disc list-inside text-gray-700 space-y-1 mb-6">
                    </ul>
                 <div class="text-center space-x-4">
                    <button onclick="restartCurrentModule()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                        Reiniciar M√≥dulo
                    </button>
                     <button onclick="goToMainMenu()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                        Men√∫ Principal
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Definici√≥n de Datos de los M√≥dulos ---
        const modulesData = [
             // --- M√ìDULO 1: √ÅREAS RESTRINGIDAS ---
             {
                id: 'areas_restringidas',
                title: 'Acceso √Åreas Restringidas', // T√≠tulo m√°s corto para card
                menuIcon: 'üö´', // Emoji representativo
                subtitle: 'Art√≠culo 44',
                protocolSteps: [
                    { title: 'Paso 1: Definici√≥n y Prop√≥sito', icon: '<span>&#128272;</span><span class="mx-2">&#128681;</span><span>&#128737;</span>', color: 'text-red-600', points: ['√Åreas establecidas DENTRO de la instalaci√≥n donde se ubican activos vitales.', 'Acceso limitado/restringido para prevenir ingreso no autorizado (actores transgresores, personal no autorizado).', 'Objetivo: Evitar acciones violentas, sabotaje, destrucci√≥n o sustracci√≥n de activos vitales; proteger vida e integridad.'] },
                    { title: 'Paso 2: Determinaci√≥n y Documentaci√≥n', icon: '<span>&#128207;</span><span class="mx-2">&#128214;</span><span>&#128104;&#8205;&#128187;</span>', color: 'text-blue-500', points: ['Determinadas por el planeador del Dispositivo de Protecci√≥n F√≠sica.', 'En coordinaci√≥n con el comandante de la instalaci√≥n policial.', 'Deben documentarse en el expediente especial del dispositivo.'] },
                    { title: 'Paso 3: Control de Acceso Estricto', icon: '<span>&#128270;</span><span class="mx-2">&#10060;</span><span>&#128100;</span>', color: 'text-orange-500', points: ['Permitir √öNICAMENTE personal autorizado.', 'Evitar hacer excepciones.', 'Si hay necesidad excepcional, SOLO el responsable del √°rea restringida puede autorizar ingreso.'] },
                    { title: 'Paso 4: Mecanismos de Control y Registro', icon: '<span>&#128273;</span><span class="mx-2">&#128477;&#65039;</span><span>&#128211;</span>', color: 'text-green-500', points: ['Disponer elementos/mecanismos para dificultar acceso no autorizado (cerraduras especiales, biom√©trico, tarjeta RFID, etc.).', 'Dejar registro del ingreso (autorizado o excepcional) en sistema de informaci√≥n o libro.'] }
                ],
                 verificationQuestion: {
                    text: '¬øQui√©n puede autorizar excepcionalmente el ingreso a un √°rea restringida a personal no autorizado regularmente?',
                    options: [ { text: 'Cualquier Oficial de la unidad.', correct: false }, { text: 'El Jefe de Seguridad de la instalaci√≥n.', correct: false }, { text: '√önicamente el responsable directo del √°rea de seguridad restringida.', correct: true } ],
                    feedbackCorrect: '¬°Correcto! El Art. 44 es claro: solo el responsable del √°rea restringida puede autorizar ingresos excepcionales.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 44. La autorizaci√≥n excepcional recae √∫nicamente en el responsable del √°rea.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Acceso sin Autorizaci√≥n', icon: '<span>&#128100;</span><span class="mx-2">&#128681;</span><span>&#10067;</span>', color: 'text-yellow-600', text: 'Observa a un funcionario intentando ingresar a un √°rea claramente se√±alizada como restringida, a la cual usted sabe que no tiene autorizaci√≥n regular. El funcionario argumenta que necesita buscar un documento r√°pidamente. ¬øQu√© hace?', options: [ { id: 'a', text: '(a) Permitirle el ingreso por ser funcionario y tratarse de algo r√°pido.' }, { id: 'b', text: '(b) Impedirle el acceso e indicarle que debe solicitar autorizaci√≥n al responsable directo de esa √°rea restringida.' }, { id: 'c', text: '(c) Acompa√±arlo personalmente para asegurarse de que solo busque el documento.' }, { id: 'd', text: '(d) Informar al Jefe de Seguridad para que √©l decida.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. El Art. 44 proh√≠be el ingreso no autorizado y pide evitar excepciones.", 'b': "¬°Correcto! Se debe impedir el acceso no autorizado y dirigir al funcionario al responsable del √°rea para obtener la autorizaci√≥n excepcional si aplica, seg√∫n Art. 44.", 'c': "Incorrecto. Acompa√±arlo no suple la necesidad de autorizaci√≥n formal del responsable del √°rea.", 'd': "Incorrecto. Si bien informar puede ser necesario si persiste, la acci√≥n inmediata es impedir el acceso y dirigirlo al responsable del √°rea." } },
                     { id: 2, title: 'Escenario 2: Falta de Registro', icon: '<span>&#128273;</span><span class="mx-2">&#128211;</span><span>&#10060;</span>', color: 'text-red-600', text: 'El responsable de un √°rea restringida autoriza verbalmente el ingreso excepcional de un t√©cnico de mantenimiento. El t√©cnico ingresa y sale sin que se realice ning√∫n registro en el libro o sistema. ¬øEs correcto este procedimiento?', options: [ { id: 'a', text: '(a) S√≠, la autorizaci√≥n verbal del responsable es suficiente.' }, { id: 'b', text: '(b) No, aunque la autorizaci√≥n sea verbal, el ingreso debe quedar registrado en el sistema o libro seg√∫n Art. 44.' }, { id: 'c', text: '(c) Solo se registra si el t√©cnico permanece m√°s de una hora.' }, { id: 'd', text: '(d) El registro es opcional para personal de mantenimiento.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. La autorizaci√≥n es necesaria, pero el registro tambi√©n lo es.", 'b': "¬°Correcto! El Art. 44 exige dejar registro de los ingresos (autorizados o excepcionales) en el sistema o libro dispuesto.", 'c': "Incorrecto. El manual no establece esa condici√≥n de tiempo para el registro.", 'd': "Incorrecto. El protocolo de registro aplica a todos los ingresos autorizados a √°reas restringidas." } }
                ],
                 summaryPoints: [ 'Las √°reas restringidas protegen <strong>activos vitales</strong> (Art. 44).', 'El acceso est√° limitado a <strong>personal autorizado</strong>; excepciones requieren autorizaci√≥n del <strong>responsable del √°rea</strong> (Art. 44).', 'Se deben usar <strong>mecanismos f√≠sicos/tecnol√≥gicos</strong> para dificultar el acceso no autorizado (Art. 44).', 'Todo ingreso a un √°rea restringida debe ser <strong>registrado</strong> (Art. 44).' ]
            },
            // --- M√ìDULO 2: ACCESO PEATONAL ---
            {
                id: 'peatonal',
                title: 'Acceso Peatonal', // T√≠tulo corto
                menuIcon: 'üö∂',
                subtitle: 'Art√≠culo 46',
                protocolSteps: [
                    { title: 'Paso 1: Identificaci√≥n y Verificaci√≥n', icon: '<span>&#128195;</span> <span class="mx-2">&#128270;</span> <span>&#9888;&#65039;</span>', color: 'text-blue-500', points: ['Saludo institucional.', 'Solicitar identificaci√≥n (c√©dula, carn√©, pasaporte).', 'Verificar antecedentes y autorizaci√≥n de ingreso.', 'Registrar datos del visitante (sistema o libro).'] },
                    { title: 'Paso 2: Registro F√≠sico y de Elementos', icon: '<span>&#128110;</span> <span class="mx-2">&#128187;</span> <span>&#128021;</span>', color: 'text-orange-500', points: ['Registro a la persona (respetuoso).', 'Registro f√≠sico/tecnol√≥gico de elementos (bolsos, paquetes). ¬°Verificar armas/elementos peligrosos!', 'Si esc√°ner no es claro: Inspecci√≥n f√≠sica / Binomio canino.'] },
                    { title: 'Paso 3: Asignaci√≥n y Control de Visitantes', icon: '<span>&#127915;</span> <span class="mx-2">&#9200;</span> <span>&#128101;</span>', color: 'text-green-500', points: ['Asignar ficha/escarapela (porte visible).', 'Control de Horarios (L-V 08-12h, 14-17h; excepciones coordinadas).', 'Grupos >10: Requiere listado previo.', 'Verificar acompa√±amiento si aplica.'] },
                    { title: 'Paso 4: Manejo Especial', icon: '<span>&#128118;</span> <span class="mx-2">&#129491;</span> <span>&#128119;</span>', color: 'text-purple-500', points: ['Menores: Registro y control del responsable. Medidas especiales (colegios, etc.).', 'Trato preferencial: Gestantes, adultos mayores, discapacitados.', 'Contratistas/Practicantes: Identificaci√≥n minuciosa y verificaci√≥n.', 'Vendedores: Requieren autorizaci√≥n previa.'] },
                    { title: 'Paso 5: Restricciones Importantes', icon: '<span>&#128299;</span> <span class="mx-2">&#128187;</span> <span>&#128054;</span>', color: 'text-red-500', points: ['Armas/Explosivos: Prohibido ingreso (dejar en recepci√≥n).', 'Dispositivos electr√≥nicos (USB, c√°maras): Restringido seg√∫n unidad (pueden requerir dejarse en recepci√≥n).', 'Animales: Prohibido ingreso (excepto asistencia).', 'Uso de Huella/Tarjeta: Prohibido usarla para ingresar a terceros.', 'Acceso Vehicular: Prohibido ingreso/salida peatonal por all√≠.'] }
                ],
                verificationQuestion: {
                    text: '¬øCu√°l es el procedimiento est√°ndar si un visitante llega a las 13:00 hrs un martes sin cita previa?',
                    options: [ { text: 'Informarle el horario y negarle el acceso.', correct: false }, { text: 'Dejarlo ingresar y que espere en recepci√≥n.', correct: false }, { text: 'Informarle el horario y/o verificar si una dependencia lo espera y coordina el ingreso.', correct: true } ],
                    feedbackCorrect: '¬°Correcto! El horario est√°ndar es de 08:00-12:00 y 14:00-17:00. Fuera de ese horario, se debe coordinar con la dependencia que espera al visitante.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 46, numeral 12 sobre los horarios de visita y la necesidad de coordinaci√≥n.'
                },
                scenarios: [
                    { id: 1, title: 'Escenario 1: Alerta de Antecedentes', icon: '<span>&#128100;</span> <span class="mx-2">&#128195;</span> <span>&#9888;&#65039;</span>', color: 'text-red-600', text: 'Son las 10:00 hrs. Llega un ciudadano que desea ingresar. Al verificar sus antecedentes, el sistema arroja una alerta vigente por hurto. El ciudadano indica que es un error y necesita ingresar para poner una denuncia. ¬øCu√°l es su proceder?', options: [ { id: 'a', text: '(a) Negarle el acceso inmediatamente por la alerta de antecedentes.' }, { id: 'b', text: '(b) Permitirle el ingreso sin restricciones ya que viene a poner una denuncia.' }, { id: 'c', text: '(c) Informar al Comandante de Guardia/Jefe de Seguridad, mantener al ciudadano en el √°rea de recepci√≥n bajo vigilancia y seguir instrucciones para verificar la situaci√≥n judicial y determinar si aplica alguna actuaci√≥n policial adicional antes de permitirle continuar con su tr√°mite.' }, { id: 'd', text: '(d) Registrarlo como visitante normal ignorando la alerta.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. Si bien hay una alerta, negar el acceso sin evaluar la situaci√≥n podr√≠a impedir un tr√°mite leg√≠timo. Se debe escalar.", 'b': "Incorrecto. Permitir el ingreso sin restricciones ignora la alerta de seguridad y el riesgo potencial.", 'c': "¬°Correcto! El protocolo exige verificaci√≥n. Una alerta requiere informar al superior (Comandante de Guardia/Jefe de Seguridad) y seguir sus instrucciones para manejar la situaci√≥n y el riesgo antes de continuar.", 'd': "Incorrecto. Ignorar una alerta de antecedentes es una falla grave de seguridad." } },
                    { id: 2, title: 'Escenario 2: Elementos Sospechosos', icon: '<span>&#128119;</span> <span class="mx-2">&#128187;</span> <span>&#128270;</span>', color: 'text-orange-600', text: 'Un contratista conocido, que realiza mantenimiento semanal, intenta ingresar un malet√≠n grande. Al pasarlo por el esc√°ner de Rayos X, usted nota varios objetos met√°licos densos no identificables claramente. El contratista dice que son sus herramientas de siempre. ¬øQu√© acci√≥n toma?', options: [ { id: 'a', text: '(a) Permitir el ingreso ya que es conocido y son sus herramientas habituales.' }, { id: 'b', text: '(b) Solicitarle abrir el malet√≠n para una inspecci√≥n f√≠sica detallada de los objetos sospechosos.' }, { id: 'c', text: '(c) Si la inspecci√≥n visual no aclara la naturaleza de los objetos, solicitar apoyo del binomio gu√≠a-canino antiexplosivos, si est√° disponible.' }, { id: 'd', text: '(d) Tanto (b) como (c) son acciones v√°lidas y complementarias seg√∫n el protocolo.' } ], correctAnswer: 'd', feedback: { 'a': "Incorrecto. Ser conocido no exime del cumplimiento de los protocolos de seguridad, especialmente si el esc√°ner muestra algo inusual.", 'b': "Parcialmente correcto, pero incompleto. La inspecci√≥n f√≠sica es necesaria, pero puede no ser suficiente.", 'c': "Parcialmente correcto, pero incompleto. Solicitar el binomio canino es una buena medida si la inspecci√≥n f√≠sica no es concluyente.", 'd': "¬°Correcto! Seg√∫n Art. 46, num. 17, si el esc√°ner no es √≥ptimo, se procede a revisar el interior y/o usar el binomio canino. Ambas acciones son v√°lidas y complementarias." } },
                    { id: 3, title: 'Escenario 3: Incumplimiento de Protocolo', icon: '<span>&#128104;&#8205;&#128110;</span> <span class="mx-2">&#128195;</span> <span>&#10060;</span>', color: 'text-yellow-600', text: 'Observa a un funcionario utilizando su tarjeta de proximidad para darle acceso a otro funcionario uniformado que no la porta en ese momento. ¬øQu√© debe hacer?', options: [ { id: 'a', text: '(a) No intervenir, es un asunto entre compa√±eros.' }, { id: 'b', text: '(b) Acercarse y recordarles amablemente que cada uno debe usar su propio medio de acceso.' }, { id: 'c', text: '(c) Impedir el acceso del segundo funcionario hasta que use su propio medio e informar la novedad al superior inmediato o registrar el incidente, seg√∫n lo dispuesto para el manejo de incumplimientos.' }, { id: 'd', text: '(d) Permitir el paso pero anotar mentalmente la situaci√≥n.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. La seguridad es responsabilidad de todos y los protocolos deben cumplirse.", 'b': "Incorrecto. Un recordatorio amable puede no ser suficiente para corregir una transgresi√≥n del protocolo.", 'c': "¬°Correcto! Se debe impedir la acci√≥n incorrecta, asegurar el cumplimiento del protocolo (cada uno usa su medio) e informar la novedad seg√∫n lo establecido (Art. 73, num. 20 menciona acciones ante incumplimientos).", 'd': "Incorrecto. No tomar acci√≥n permite que la transgresi√≥n ocurra y no se corrija." } }
                ],
                summaryPoints: [ 'La <strong>identificaci√≥n y verificaci√≥n</strong> son cruciales (Art. 46).', 'El <strong>registro minucioso</strong> de personas y elementos previene riesgos (Art. 46).', 'Respeta los <strong>horarios</strong> y procedimientos para visitas especiales/grupos (Art. 46).', 'Aplica las <strong>restricciones</strong> sobre armas y dispositivos electr√≥nicos (Art. 46).', 'Ante <strong>dudas o alertas</strong>, informa siempre a tu superior.', 'El cumplimiento estricto de los protocolos es responsabilidad de todos.' ]
            },
             // --- M√ìDULO 3: ACCESO VEHICULAR ---
            {
                id: 'vehicular',
                title: 'Acceso Vehicular', // T√≠tulo corto
                menuIcon: 'üöó',
                subtitle: 'Art√≠culo 47',
                protocolSteps: [
                    { title: 'Paso 1: Abordaje Inicial', icon: '<span>&#128663;</span><span class="mx-2">&#128737;</span><span>&#128100;</span>', color: 'text-blue-500', points: ['Saludo institucional.', 'Solicitud de apagado del veh√≠culo.', 'Identificaci√≥n del conductor y documentos del veh√≠culo (c√©dula, licencia conducci√≥n/tr√°nsito, carn√© policial, etc.).'] },
                    { title: 'Paso 2: Verificaci√≥n y Autorizaci√≥n', icon: '<span>&#128270;</span><span class="mx-2">&#128196;</span><span>&#9989;</span>', color: 'text-teal-500', points: ['Verificaci√≥n de antecedentes (conductor).', 'Comprobar la autorizaci√≥n de ingreso.', 'Registrar informaci√≥n del visitante y veh√≠culo (sistema o libro).'] },
                    { title: 'Paso 3: Registro F√≠sico (Veh√≠culo y Ocupantes)', icon: '<span>&#128270;</span><span class="mx-2">&#128663;</span><span>&#128021;</span>', color: 'text-orange-500', points: ['Solicitar descenso de conductor y ocupantes (salvo excepciones m√©dicas/autorizadas).', 'Registro a personas (conductor/ocupantes).', 'Registro f√≠sico del veh√≠culo/moto: cabina, ba√∫l, motor, etc. (usar espejo convexo si hay).', 'Revisi√≥n con binomio gu√≠a-canino antiexplosivos (si aplica/hay).'] },
                    { title: 'Paso 4: Ingreso Controlado', icon: '<span>&#128678;</span><span class="mx-2">&#128659;</span><span>&#128285;</span>', color: 'text-red-500', points: ['Solo el conductor ingresa el veh√≠culo a la zona de seguridad.', 'Vidrios abajo (si aplica).', 'Velocidad m√°xima: 10 km/h.', 'Luces de estacionamiento/direccionales encendidas al desplazarse.', 'Motocicletas/bicicletas: Ingresar sin casco, llevando el veh√≠culo de la mano.'] },
                    { title: 'Paso 5: Manejo de Elementos Peligrosos', icon: '<span>&#128163;</span><span class="mx-2">&#9763;</span><span>&#128299;</span>', color: 'text-red-700', points: ['En caso de hallar posibles elementos peligrosos (explosivos, NBQR), aplicar gu√≠as correspondientes (2DC-GU-0010, 2DC-GU-0015) o normas vigentes.'] }
                ],
                 verificationQuestion: {
                    text: '¬øCu√°l es la velocidad m√°xima permitida para un veh√≠culo dentro de las instalaciones policiales?',
                    options: [ { text: '5 km/h', correct: false }, { text: '10 km/h', correct: true }, { text: '20 km/h', correct: false }, { text: 'No hay l√≠mite especificado', correct: false } ],
                    feedbackCorrect: '¬°Correcto! Seg√∫n el Art. 47, numeral 16, la velocidad m√°xima es de 10 km/h.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 47, numeral 16. La velocidad m√°xima establecida es de 10 km/h.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Ocupantes Reacios', icon: '<span>&#128663;</span><span class="mx-2">&#128101;</span><span>&#10060;</span>', color: 'text-yellow-600', text: 'Un veh√≠culo particular con 3 ocupantes solicita ingreso. Al pedirles que desciendan para el registro, el conductor accede pero los pasajeros se niegan argumentando que tienen prisa. ¬øC√≥mo procede?', options: [ { id: 'a', text: '(a) Permite el ingreso registrando solo al conductor y al veh√≠culo, para no generar demoras.' }, { id: 'b', text: '(b) Insiste firmemente en que TODOS deben descender para el registro seg√∫n el protocolo (Art. 47, num. 11), explicando que es un requisito de seguridad. Si persisten, informa al superior.' }, { id: 'c', text: '(c) Les niega el ingreso inmediatamente debido a la negativa.' }, { id: 'd', text: '(d) Realiza un registro visual r√°pido a los pasajeros desde afuera del veh√≠culo.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. No registrar a todos los ocupantes es una omisi√≥n del protocolo y un riesgo.", 'b': "¬°Correcto! El Art. 47, num. 11 es claro: conductor y ocupantes deben descender. Se debe insistir en el cumplimiento y escalar la situaci√≥n al superior si hay negativa persistente.", 'c': "Incorrecto. Aunque la negativa es una falta, la primera acci√≥n debe ser insistir y explicar, luego escalar, antes de negar el acceso directamente (a menos que haya otras se√±ales de riesgo).", 'd': "Incorrecto. Un registro visual externo no cumple con el requerimiento de registro a personas y veh√≠culo indicado en el protocolo." } },
                     { id: 2, title: 'Escenario 2: Motociclista con Casco', icon: '<span>&#128757;</span><span class="mx-2">&#127949;</span><span>&#128270;</span>', color: 'text-blue-600', text: 'Un funcionario policial llega en su motocicleta personal e intenta ingresar conduciendo y con el casco puesto. ¬øQu√© acci√≥n debe tomar?', options: [ { id: 'a', text: '(a) Permitirle el ingreso sin detenerlo, ya que es un funcionario conocido.' }, { id: 'b', text: '(b) Detenerlo y solicitarle que se quite el casco para identificaci√≥n, pero permitirle ingresar conduciendo.' }, { id: 'c', text: '(c) Indicarle que debe quitarse el casco y llevar la motocicleta de la mano para ingresar, seg√∫n el protocolo (Art. 47, num. 15).' }, { id: 'd', text: '(d) Saludarlo y recordarle para la pr√≥xima vez que debe quitarse el casco.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. Ser funcionario no exime del cumplimiento de los protocolos de seguridad para el ingreso.", 'b': "Incorrecto. El protocolo exige quitarse el casco Y llevar el veh√≠culo de la mano.", 'c': "¬°Correcto! El Art. 47, num. 15 especifica claramente que quien ingrese en moto o bicicleta debe hacerlo sin casco y llevando el veh√≠culo de la mano para su identificaci√≥n.", 'd': "Incorrecto. El protocolo debe aplicarse en el momento, no solo recordarse para el futuro." } }
                ],
                 summaryPoints: [ 'La <strong>identificaci√≥n</strong> del conductor y la <strong>verificaci√≥n</strong> de documentos y autorizaci√≥n son esenciales (Art. 47).', 'El <strong>registro f√≠sico</strong> minucioso del veh√≠culo y <strong>TODOS</strong> sus ocupantes es obligatorio (Art. 47).', 'Existen <strong>normas espec√≠ficas</strong> para el ingreso: velocidad, luces, descenso de ocupantes, ingreso de motos/bicis (Art. 47).', 'Ante hallazgos peligrosos, se deben activar los <strong>protocolos NBQR/Explosivos</strong> correspondientes (Art. 47).' ]
            },
             // --- M√ìDULO 4: VISITAS ESPECIALES / EVENTOS ---
            {
                id: 'visitas_especiales',
                title: 'Visitas Especiales / Eventos', // T√≠tulo corto
                menuIcon: '‚≠ê',
                subtitle: 'Art√≠culo 48',
                protocolSteps: [
                    { title: 'Paso 1: Coordinaci√≥n Previa', icon: '<span>&#128197;</span><span class="mx-2">&#128221;</span><span>&#128101;</span>', color: 'text-blue-500', points: ['Responsable del evento debe informar PREVIAMENTE al Jefe de Seguridad.', 'Si son >10 personas: Anexar listado (nombres, ID, hora E/S, motivo, entidad, placas veh√≠culos, qui√©n recibe).'] },
                    { title: 'Paso 2: Registro y Acompa√±amiento', icon: '<span>&#128214;</span><span class="mx-2">&#128100;</span><span>&#128279;</span>', color: 'text-green-500', points: ['Registrar ingreso seg√∫n listado o informaci√≥n de dependencia responsable.', 'Funcionarios acompa√±antes deben socializar plan de emergencia/evacuaci√≥n.', 'Asegurar acompa√±amiento durante ingreso y egreso.'] },
                    { title: 'Paso 3: Manejo de Esquemas de Seguridad', icon: '<span>&#128737;</span><span class="mx-2">&#128299;</span><span>&#128681;</span>', color: 'text-orange-500', points: ['Ubicar esquema en lugar determinado (parqueadero, sala espera).', 'Verificar presencia de armas/elementos peligrosos y aplicar protocolo de control (Art. 50). No ingresan armados a la instalaci√≥n (salvo autorizaci√≥n expresa).'] },
                    { title: 'Paso 4: Visitas Sin Previo Aviso', icon: '<span>&#9200;</span><span class="mx-2">&#10067;</span><span>&#128222;</span>', color: 'text-yellow-600', points: ['Funcionario de seguridad comunica INMEDIATAMENTE al responsable de seguridad.', 'Oficial/Suboficial de servicio o Jefe de Info./Seguridad atiende hasta que dependencia responsable autorice o no.', 'Registrar datos si se autoriza.'] },
                    { title: 'Paso 5: Casos Particulares', icon: '<span>&#127988;</span><span class="mx-2">&#128118;</span><span>&#128738;</span>', color: 'text-purple-500', points: ['Misiones diplom√°ticas: Aplicar Decreto 615/1935 (privilegios).', 'Eventos con NNA: Requiere autorizaci√≥n del Director/Comandante y consentimiento padres/representante.', 'Eventos masivos: Implementar acciones adicionales de protecci√≥n f√≠sica (recurso humano, log√≠stico, etc.).'] }
                ],
                 verificationQuestion: {
                    text: 'Si un evento contar√° con 15 asistentes externos, ¬øqu√© informaci√≥n m√≠nima debe enviar el responsable del evento al Jefe de Seguridad?',
                    options: [ { text: 'Solo el n√∫mero de asistentes y la hora.', correct: false }, { text: 'El listado con nombres, apellidos, ID, hora E/S, motivo, entidad, placas (si aplica) y qui√©n recibe.', correct: true }, { text: 'El nombre del responsable del evento y la dependencia.', correct: false } ],
                    feedbackCorrect: '¬°Correcto! Seg√∫n el Art. 48, num. 1, para eventos con m√°s de 10 personas se requiere un listado detallado con antelaci√≥n.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 48, numeral 1. Se exige un listado completo con informaci√≥n detallada de los asistentes y veh√≠culos.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Esquema Armado', icon: '<span>&#128104;&#8205;&#128373;Ô∏è</span><span class="mx-2">&#128299;</span><span>&#10060;</span>', color: 'text-red-600', text: 'Llega una comisi√≥n de una entidad externa para una reuni√≥n. El esquema de seguridad que los acompa√±a insiste en ingresar armado a las oficinas junto con el protegido. ¬øCu√°l es el procedimiento correcto?', options: [ { id: 'a', text: '(a) Permitir el ingreso armado, ya que es un esquema de seguridad oficial.' }, { id: 'b', text: '(b) Negarles el ingreso a todos si el esquema insiste en entrar armado.' }, { id: 'c', text: '(c) Indicarles que el esquema debe permanecer en el √°rea designada (ej. recepci√≥n) y que las armas deben ser dejadas en custodia seg√∫n el protocolo (Art. 50), salvo autorizaci√≥n expresa del Director/Comandante para un caso excepcional.' }, { id: 'd', text: '(d) Permitir que solo un miembro del esquema ingrese armado.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. El Art. 48 num. 4 y el Art. 50 establecen que no se ingresa armado a las instalaciones, salvo excepciones autorizadas.", 'b': "Incorrecto. La primera acci√≥n no es negar el ingreso a la visita, sino aplicar el protocolo para el esquema y sus armas.", 'c': "¬°Correcto! Se debe ubicar al esquema en el lugar designado y aplicar el protocolo de control de armas (Art. 50). El ingreso armado es excepcional y requiere autorizaci√≥n superior.", 'd': "Incorrecto. El protocolo no contempla permitir el ingreso de un solo miembro armado como norma general." } },
                     { id: 2, title: 'Escenario 2: Visita Sorpresa', icon: '<span>&#128100;</span><span class="mx-2">&#10067;</span><span>&#128222;</span>', color: 'text-yellow-600', text: 'Se presenta en la guardia una persona que dice ser un alto funcionario de otra entidad y solicita una reuni√≥n urgente con el Comandante, sin previo aviso. ¬øQu√© debe hacer el personal de seguridad de la guardia?', options: [ { id: 'a', text: '(a) Dejarlo ingresar inmediatamente a la oficina del Comandante por cortes√≠a interinstitucional.' }, { id: 'b', text: '(b) Negarle el acceso por no tener cita previa.' }, { id: 'c', text: '(c) Comunicar inmediatamente al Jefe de Seguridad/Oficial de Servicio, atender a la visita en un √°rea de espera mientras se verifica con la dependencia (Comandante) si autoriza o no la visita.' }, { id: 'd', text: '(d) Solicitarle que espere afuera de las instalaciones hasta que el Comandante lo llame.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. El protocolo para visitas sin previo aviso (Art. 48 num. 5) exige comunicaci√≥n y autorizaci√≥n interna antes de permitir el ingreso.", 'b': "Incorrecto. Aunque no haya aviso, se debe seguir el procedimiento de verificaci√≥n antes de negar el acceso.", 'c': "¬°Correcto! El Art. 48, num. 5 indica que se debe comunicar al responsable de seguridad, atender la visita y esperar la autorizaci√≥n de la dependencia solicitada.", 'd': "Incorrecto. Se debe atender a la visita en un lugar apropiado dentro de la instalaci√≥n mientras se gestiona la autorizaci√≥n." } }
                ],
                 summaryPoints: [ 'La <strong>coordinaci√≥n previa</strong> es clave para eventos y visitas grupales (Art. 48).', 'El <strong>registro y acompa√±amiento</strong> adecuado garantizan el control (Art. 48).', 'Los <strong>esquemas de seguridad</strong> tienen un manejo espec√≠fico, incluyendo el control de armas (Art. 48 y 50).', 'Las <strong>visitas sin previo aviso</strong> requieren comunicaci√≥n interna y autorizaci√≥n antes del ingreso (Art. 48).', 'Existen consideraciones especiales para <strong>misiones diplom√°ticas y eventos con NNA</strong> (Art. 48).' ]
            },
             // --- M√ìDULO 5: UNIDADES DE APOYO ---
            {
                id: 'unidades_apoyo',
                title: 'Acceso Unidades de Apoyo', // T√≠tulo corto
                menuIcon: 'ü§ù',
                subtitle: 'Art√≠culo 49',
                protocolSteps: [
                    { title: 'Paso 1: Coordinaci√≥n y Documentaci√≥n', icon: '<span>&#128104;&#8205;&#128110;</span><span class="mx-2">&#128197;</span><span>&#128221;</span>', color: 'text-blue-500', points: ['Apoyos deben ser coordinados PREVIAMENTE.', 'Verificar documentaci√≥n soporte (directiva, orden servicio, poligrama, misi√≥n trabajo, etc.).'] },
                    { title: 'Paso 2: Verificaci√≥n y Registro', icon: '<span>&#128270;</span><span class="mx-2">&#128101;</span><span>&#128214;</span>', color: 'text-green-500', points: ['Responsable de seguridad toma contacto con uniformado de mayor grado/jerarqu√≠a del apoyo para verificar ingreso.', 'Registrar ingreso: nombres, apellidos, fecha/hora E/S, motivo, dependencia responsable, unidad origen.'] },
                    { title: 'Paso 3: Alojamiento y Seguridad Propia', icon: '<span>&#127968;</span><span class="mx-2">&#128737;</span><span>&#128110;</span>', color: 'text-orange-500', points: ['Si el personal NO se aloja en la unidad receptora: Coordinar con mando del apoyo la instalaci√≥n de su propio dispositivo de seguridad (previa autorizaci√≥n).'] },
                    { title: 'Paso 4: Instrucci√≥n Obligatoria', icon: '<span>&#128218;</span><span class="mx-2">&#128172;</span><span>&#9888;&#65039;</span>', color: 'text-purple-500', points: ['Dar instrucci√≥n al personal de apoyo sobre: Plan Defensa Instalaciones, plan evacuaci√≥n, actuaci√≥n emergencias, protocolos de seguridad de la instalaci√≥n receptora.'] },
                    { title: 'Paso 5: Refuerzo por Alto N√∫mero', icon: '<span>&#128101;&#10133;</span><span class="mx-2">&#128738;</span><span>&#128681;</span>', color: 'text-red-500', points: ['Si llega un alto n√∫mero de personal de apoyo: Implementar acciones ADICIONALES de protecci√≥n f√≠sica (recurso humano, log√≠stico, protocolos, etc.).'] }
                ],
                 verificationQuestion: {
                    text: '¬øQu√© instrucci√≥n es obligatorio impartir al personal de unidades de apoyo que llega a una instalaci√≥n?',
                    options: [ { text: 'Solo las normas de convivencia de la unidad.', correct: false }, { text: 'El Plan Defensa, plan evacuaci√≥n, actuaci√≥n en emergencias y protocolos de seguridad locales.', correct: true }, { text: '√önicamente la ubicaci√≥n de las √°reas comunes.', correct: false } ],
                    feedbackCorrect: '¬°Correcto! El Art. 49, num. 4, exige dar instrucci√≥n completa sobre los planes y protocolos de seguridad de la instalaci√≥n receptora.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 49, numeral 4. La instrucci√≥n debe cubrir aspectos cr√≠ticos de seguridad y emergencia locales.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Llegada sin Coordinaci√≥n', icon: '<span>&#128104;&#8205;&#128110;</span><span class="mx-2">&#10067;</span><span>&#128221;</span>', color: 'text-yellow-600', text: 'Se presenta un grupo de uniformados de otra unidad indicando que vienen de apoyo para un servicio, pero no hay coordinaci√≥n previa ni documentaci√≥n soporte visible. ¬øQu√© debe hacer?', options: [ { id: 'a', text: '(a) Permitirles el ingreso y luego verificar la informaci√≥n.' }, { id: 'b', text: '(b) Negarles el acceso hasta que presenten una orden escrita.' }, { id: 'c', text: '(c) Retener al personal en la guardia, tomar contacto con el de mayor jerarqu√≠a, e informar INMEDIATAMENTE al Jefe de Seguridad/Comandante de Guardia para que verifique la coordinaci√≥n y autenticidad del apoyo antes de permitir el ingreso y registro.' }, { id: 'd', text: '(d) Dejarlos ingresar pero no asignarles alojamiento ni darles instrucci√≥n.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. Permitir el ingreso sin verificar la coordinaci√≥n y documentaci√≥n es un riesgo de seguridad.", 'b': "Incorrecto. Si bien se requiere documentaci√≥n, la acci√≥n inmediata es verificar con el mando antes de negar el acceso, podr√≠a ser una coordinaci√≥n verbal no comunicada a la guardia.", 'c': "¬°Correcto! El Art. 49 exige coordinaci√≥n previa y verificaci√≥n. Ante la duda, se debe retener temporalmente, contactar al mando del grupo y al mando local para confirmar antes de proceder.", 'd': "Incorrecto. Si ingresan, deben recibir instrucci√≥n; adem√°s, permitir el ingreso sin verificaci√≥n es incorrecto." } },
                     { id: 2, title: 'Escenario 2: Instrucci√≥n Omitida', icon: '<span>&#128218;</span><span class="mx-2">&#10060;</span><span>&#128172;</span>', color: 'text-red-600', text: 'Llega un grupo de apoyo coordinado y documentado. El responsable de seguridad realiza el registro pero omite darles la instrucci√≥n sobre el Plan de Defensa y evacuaci√≥n por falta de tiempo. ¬øEs esto aceptable?', options: [ { id: 'a', text: '(a) S√≠, si hay mucho trabajo, la instrucci√≥n puede esperar.' }, { id: 'b', text: '(b) No, la instrucci√≥n sobre planes y protocolos locales es obligatoria seg√∫n el Art. 49 num. 4 y debe darse al momento del ingreso o lo antes posible.' }, { id: 'c', text: '(c) S√≠, porque el personal de apoyo ya debe conocer los procedimientos generales.' }, { id: 'd', text: '(d) Solo es necesario si el apoyo es por m√°s de 24 horas.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. La falta de tiempo no justifica omitir una instrucci√≥n de seguridad cr√≠tica.", 'b': "¬°Correcto! El Art. 49, numeral 4, establece claramente la obligatoriedad de impartir la instrucci√≥n sobre planes y protocolos locales al personal de apoyo.", 'c': "Incorrecto. Los planes y protocolos son espec√≠ficos de cada instalaci√≥n y deben ser conocidos por todo el personal presente, incluyendo apoyos.", 'd': "Incorrecto. El manual no establece un tiempo m√≠nimo de permanencia para requerir la instrucci√≥n; debe darse a todo personal de apoyo." } }
                ],
                 summaryPoints: [ 'La <strong>coordinaci√≥n previa</strong> y la <strong>verificaci√≥n documental</strong> son fundamentales para recibir unidades de apoyo (Art. 49).', 'El <strong>registro detallado</strong> del personal de apoyo es obligatorio (Art. 49).', 'La <strong>instrucci√≥n sobre planes y protocolos locales</strong> (Defensa, Evacuaci√≥n, Seguridad) es mandatoria para el personal de apoyo (Art. 49).', 'Se deben prever <strong>medidas adicionales</strong> si llega un gran n√∫mero de personal de apoyo (Art. 49).' ]
            },
             // --- M√ìDULO 6: CONTROL DE ARMAS ---
            {
                id: 'control_armas',
                title: 'Control de Armas', // T√≠tulo corto
                menuIcon: 'üî´',
                subtitle: 'Art√≠culo 50',
                protocolSteps: [
                    { title: 'Paso 1: Prohibici√≥n General', icon: '<span>&#128299;</span><span class="mx-2">&#10060;</span><span>&#128737;</span>', color: 'text-red-600', points: ['NO est√° autorizado el porte de armamento dentro de las instalaciones policiales.', 'Excepci√≥n: Personal de seguridad de la propia instalaci√≥n.', 'Excepci√≥n: Personal de apoyo con armamento si hay autorizaci√≥n EXPRESA del Director/Comandante/Jefe.'] },
                    { title: 'Paso 2: Custodia Obligatoria', icon: '<span>&#128274;</span><span class="mx-2">&#128230;</span><span>&#128214;</span>', color: 'text-orange-500', points: ['Se debe acondicionar un espacio apropiado (casillero con cerradura) para almacenar armamento de visitantes (particulares y uniformados).', 'El espacio debe garantizar seguridad (evitar p√©rdida/manipulaci√≥n).'] },
                    { title: 'Paso 3: Registro Detallado', icon: '<span>&#128211;</span><span class="mx-2">&#128196;</span><span>&#9997;</span>', color: 'text-blue-500', points: ['TODA arma guardada debe ser registrada en el sistema de informaci√≥n o libro dispuesto para tal fin.', 'Registrar datos del arma y del propietario.'] }
                ],
                 verificationQuestion: {
                    text: '¬øPuede un funcionario policial de otra unidad ingresar armado a una instalaci√≥n si viene de visita?',
                    options: [ { text: 'S√≠, siempre, por ser funcionario.', correct: false }, { text: 'No, nunca, sin excepciones.', correct: false }, { text: 'No como regla general, debe dejar el arma en custodia. Solo podr√≠a ingresar armado si hay autorizaci√≥n expresa del Director/Comandante de la instalaci√≥n visitada.', correct: true } ],
                    feedbackCorrect: '¬°Correcto! El Art. 50 establece la prohibici√≥n general y la necesidad de custodia, salvo autorizaci√≥n expresa del mando de la unidad que recibe la visita.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 50. La norma general es no ingresar armado, pero existen excepciones con autorizaci√≥n expresa.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Visitante Armado', icon: '<span>&#128100;</span><span class="mx-2">&#128299;</span><span>&#128274;</span>', color: 'text-orange-600', text: 'Un ciudadano particular que tiene permiso vigente de porte de armas intenta ingresar a la instalaci√≥n portando su arma de fuego. ¬øCu√°l es el procedimiento correcto?', options: [ { id: 'a', text: '(a) Permitirle el ingreso con el arma, ya que tiene permiso legal.' }, { id: 'b', text: '(b) Indicarle amablemente que, seg√∫n el protocolo interno (Art. 50), no puede ingresar armado y que debe dejar el arma en custodia en el lugar designado (casillero), registr√°ndola debidamente.' }, { id: 'c', text: '(c) Negarle el ingreso a la instalaci√≥n por portar un arma.' }, { id: 'd', text: '(d) Llamar al Comandante para que autorice el ingreso armado.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. El permiso legal de porte no anula el protocolo de seguridad interno de la instalaci√≥n policial (Art. 50).", 'b': "¬°Correcto! El Art. 50 proh√≠be el ingreso armado (salvo excepciones muy espec√≠ficas) y exige la custodia y registro del arma del visitante.", 'c': "Incorrecto. No se le niega el ingreso a la persona, se le aplica el protocolo para el arma.", 'd': "Incorrecto. La autorizaci√≥n expresa del Comandante es para casos excepcionales de personal de apoyo, no para visitantes particulares como norma general." } },
                    { id: 2, title: 'Escenario 2: Falta de Registro', icon: '<span>&#128299;</span><span class="mx-2">&#128211;</span><span>&#10067;</span>', color: 'text-red-600', text: 'Al recibir el turno, nota que hay un arma en el casillero de custodia, pero no encuentra ning√∫n registro de esta en el libro o sistema correspondiente. ¬øQu√© debe hacer?', options: [ { id: 'a', text: '(a) Ignorar la situaci√≥n, probablemente olvidaron registrarla.' }, { id: 'b', text: '(b) Intentar averiguar de qui√©n es y registrarla si lo descubre.' }, { id: 'c', text: '(c) Informar INMEDIATAMENTE la novedad al superior (Comandante de Guardia/Jefe de Seguridad) para que se investigue la procedencia del arma y la omisi√≥n en el registro.' }, { id: 'd', text: '(d) Guardar el arma en otro lugar m√°s seguro.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. Ignorar una irregularidad con armamento es una falta grave.", 'b': "Incorrecto. Aunque averiguar es bueno, la prioridad es informar la novedad al superior para una acci√≥n oficial.", 'c': "¬°Correcto! La falta de registro de un arma en custodia es una novedad grave que debe ser informada inmediatamente al superior para determinar responsabilidades y acciones a seguir.", 'd': "Incorrecto. Mover un arma sin registrar y sin autorizaci√≥n superior puede generar m√°s problemas." } }
                ],
                 summaryPoints: [ 'El porte de armas est√° <strong>prohibido</strong> dentro de las instalaciones como norma general (Art. 50).', 'Existen <strong>excepciones muy limitadas</strong> y requieren autorizaci√≥n expresa (Art. 50).', 'Es <strong>obligatorio</strong> disponer de un lugar seguro para la <strong>custodia</strong> de armas de visitantes (Art. 50).', 'El <strong>registro detallado</strong> de toda arma en custodia es mandatorio (Art. 50).' ]
            },
             // --- M√ìDULO 7: PERSONAS DETENIDAS ---
            {
                id: 'detenidos',
                title: 'Acceso Personas Detenidas', // T√≠tulo corto
                menuIcon: '‚õìÔ∏è',
                subtitle: 'Art√≠culo 51',
                protocolSteps: [
                    { title: 'Paso 1: Custodia Permanente', icon: '<span>&#128110;</span><span class="mx-2">&#128272;</span><span>&#128064;</span>', color: 'text-blue-500', points: ['Jefe de Seguridad/Polic√≠a de turno debe prever que la persona privada de la libertad (PPL) est√© SIEMPRE custodiada por los funcionarios encargados.', 'Aplica para PPL bajo custodia de cualquier entidad estatal competente (Polic√≠a, INPEC, etc.).'] },
                    { title: 'Paso 2: Registro Detallado', icon: '<span>&#128211;</span><span class="mx-2">&#128100;</span><span>&#129309;</span>', color: 'text-orange-500', points: ['Registrar ingreso en libro/sistema:', 'Datos de la PPL.', 'Motivo del ingreso.', 'Estado y condiciones f√≠sicas de la PPL.', 'Datos personales del responsable de la custodia.'] },
                    { title: 'Paso 3: Medidas de Seguridad F√≠sicas', icon: '<span>&#128272;</span><span class="mx-2">&#128070;</span><span>&#128071;</span>', color: 'text-red-600', points: ['Detenidos deben ingresar esposados.', 'Manos atr√°s para prevenir acciones riesgosas.'] },
                    { title: 'Paso 4: Caso INPEC (Procedimientos M√©dicos)', icon: '<span>&#128657;</span><span class="mx-2">&#128104;&#8205;&#9877;&#65039;</span><span>&#128737;</span>', color: 'text-green-500', points: ['Si INPEC trae PPL para procedimiento m√©dico: Oficial/Suboficial de servicio o encargado de seguridad permite ingreso.', 'Emitir recomendaciones de seguridad seg√∫n el caso.', 'Garantizar acompa√±amiento policial al personal INPEC y PPL hasta su salida.', 'Si son varias PPL, coordinar varios funcionarios para acompa√±amiento.'] }
                ],
                 verificationQuestion: {
                    text: '¬øC√≥mo debe ingresar una persona detenida a una instalaci√≥n policial?',
                    options: [ { text: 'Sin esposas si est√° tranquila.', correct: false }, { text: 'Esposada con las manos adelante.', correct: false }, { text: 'Esposada con las manos atr√°s.', correct: true } ],
                    feedbackCorrect: '¬°Correcto! El Art. 51 especifica que deben ingresar esposados y con las manos atr√°s por seguridad.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 51. La medida de seguridad f√≠sica est√°ndar es esposado con manos atr√°s.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Registro Incompleto', icon: '<span>&#128211;</span><span class="mx-2">&#10067;</span><span>&#128100;</span>', color: 'text-yellow-600', text: 'Una patrulla ingresa con una persona capturada. Realizan el registro de la PPL pero omiten registrar los datos del funcionario responsable de la custodia. ¬øEs correcto este procedimiento?', options: [ { id: 'a', text: '(a) S√≠, lo importante es registrar al detenido.' }, { id: 'b', text: '(b) No, el Art. 51 exige registrar tanto los datos de la PPL como los del responsable de su custodia.' }, { id: 'c', text: '(c) Solo es necesario registrar al custodio si el detenido va a permanecer m√°s de una hora.' }, { id: 'd', text: '(d) S√≠, si el custodio es conocido en la unidad.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. El registro debe ser completo seg√∫n el protocolo.", 'b': "¬°Correcto! El Art. 51 es claro en que se deben registrar los datos de la PPL, motivo, estado Y los datos del responsable de la custodia.", 'c': "Incorrecto. El manual no establece esa condici√≥n de tiempo para el registro del custodio.", 'd': "Incorrecto. Ser conocido no exime del registro obligatorio." } },
                     { id: 2, title: 'Escenario 2: INPEC sin Acompa√±amiento', icon: '<span>&#128657;</span><span class="mx-2">&#128110;</span><span>&#10060;</span>', color: 'text-red-600', text: 'Personal del INPEC ingresa con una PPL para una cita m√©dica en sanidad policial. El Oficial de servicio permite el ingreso pero no asigna personal policial para acompa√±arlos hasta el consultorio y durante su permanencia. ¬øActu√≥ correctamente?', options: [ { id: 'a', text: '(a) S√≠, la custodia es responsabilidad exclusiva del INPEC dentro de la instalaci√≥n.' }, { id: 'b', text: '(b) No, el Art. 51 num. 4 indica que se debe garantizar el acompa√±amiento policial al personal INPEC y PPL hasta su salida.' }, { id: 'c', text: '(c) Solo se requiere acompa√±amiento si la PPL es de alta peligrosidad.' }, { id: 'd', text: '(d) El acompa√±amiento es opcional y depende de la disponibilidad de personal.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. Aunque INPEC mantiene la custodia primaria, el protocolo exige acompa√±amiento policial dentro de la instalaci√≥n.", 'b': "¬°Correcto! El Art. 51, numeral 4, establece expl√≠citamente que se debe garantizar el acompa√±amiento policial al personal del INPEC y la PPL durante su permanencia para procedimientos m√©dicos.", 'c': "Incorrecto. El manual no hace esa distinci√≥n; el acompa√±amiento aplica al procedimiento descrito.", 'd': "Incorrecto. El manual lo establece como una garant√≠a, no como algo opcional." } }
                ],
                 summaryPoints: [ 'La <strong>custodia permanente</strong> por funcionarios responsables es esencial al ingresar PPL (Art. 51).', 'El <strong>registro detallado</strong> (PPL, motivo, estado, custodio) es obligatorio (Art. 51).', 'Las PPL deben ingresar <strong>esposadas y con manos atr√°s</strong> por seguridad (Art. 51).', 'Para PPL tra√≠das por INPEC a procedimientos m√©dicos, se debe <strong>garantizar acompa√±amiento policial</strong> (Art. 51).' ]
            },
             // --- M√ìDULO 8: PARQUEADERO ---
            {
                id: 'parqueadero',
                title: 'Control de Parqueadero', // T√≠tulo corto
                menuIcon: 'üÖøÔ∏è',
                subtitle: 'Art√≠culo 52',
                protocolSteps: [
                    { title: 'Paso 1: Distribuci√≥n y Demarcaci√≥n', icon: '<span>üÖøÔ∏è</span><span class="mx-2">&#128663;</span><span>&#128207;</span>', color: 'text-blue-500', points: ['Distribuir espacios: veh√≠culos institucionales, funcionarios, visitas especiales, personas con discapacidad/movilidad reducida.', 'Enumerar y demarcar espacios (ayuda a control y asignaci√≥n de ficheros).'] },
                    { title: 'Paso 2: Personal de Seguridad y Control', icon: '<span>&#128110;</span><span class="mx-2">&#127915;</span><span>&#128064;</span>', color: 'text-green-500', points: ['Contar con personal de seguridad en parqueadero.', 'Funciones: Controlar parqueo en lugar asignado, verificar ficha de parqueo.', 'Verificar a las 19:00 hrs retiro de veh√≠culos no autorizados a pernoctar (salvo funcionarios/visitantes a√∫n en labores).'] },
                    { title: 'Paso 3: Registros y Ficheros', icon: '<span>&#128214;</span><span class="mx-2">&#128196;</span><span>&#127915;</span>', color: 'text-orange-500', points: ['Mantener base de datos actualizada (propietario/conductor, contacto, placa, marca, tipo, dependencia visita, etc.).', 'Ficheros de parqueo actualizados y de uso obligatorio (evita suplantaci√≥n).'] },
                    { title: 'Paso 4: Normas de Permanencia y Circulaci√≥n', icon: '<span>&#128681;</span><span class="mx-2">&#128285;</span><span>&#128694;</span>', color: 'text-red-500', points: ['Veh√≠culos no institucionales NO pueden pernoctar (m√°s all√° del tiempo de visita/servicio).', 'Velocidad m√°xima: 10 km/h.', 'Parqueadero debe tener buena iluminaci√≥n y zonas peatonales demarcadas.'] },
                    { title: 'Paso 5: Seguridad Adicional', icon: '<span>&#128021;</span><span class="mx-2">&#128247;</span><span>&#128142;</span>', color: 'text-purple-500', points: ['No dejar objetos de valor dentro de los veh√≠culos.', 'Si hay binomios gu√≠a-caninos antiexplosivos: Realizar inspecciones peri√≥dicas.', 'Recomendable: Contar con circuito cerrado de televisi√≥n (CCTV).'] }
                ],
                 verificationQuestion: {
                    text: '¬øHasta qu√© hora pueden permanecer los veh√≠culos de visitantes en el parqueadero, como norma general?',
                    options: [ { text: 'Hasta las 17:00 hrs.', correct: false }, { text: 'Hasta las 19:00 hrs, a menos que el visitante siga en gestiones.', correct: true }, { text: 'Pueden pernoctar si el visitante lo desea.', correct: false } ],
                    feedbackCorrect: '¬°Correcto! El Art. 52, num. 3c, indica que a las 19:00 hrs se verifica el retiro, excepto si el funcionario/visitante a√∫n est√° laborando/gestionando.',
                    feedbackIncorrect: 'Incorrecto. Revisa el Art. 52, numeral 3c. La hora de verificaci√≥n es las 19:00 hrs, con excepciones.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Veh√≠culo sin Ficha', icon: '<span>&#128663;</span><span class="mx-2">&#127915;</span><span>&#10067;</span>', color: 'text-yellow-600', text: 'Durante su ronda por el parqueadero, observa un veh√≠culo particular estacionado en la zona de funcionarios, pero no tiene ninguna ficha de parqueo visible. ¬øQu√© acci√≥n debe tomar?', options: [ { id: 'a', text: '(a) Ignorarlo, probablemente sea de un funcionario que olvid√≥ poner la ficha.' }, { id: 'b', text: '(b) Verificar en la base de datos del parqueadero (por placa) si corresponde a un funcionario autorizado y, de ser as√≠, recordarle la obligatoriedad de la ficha. Si no est√° en la base, informar al superior.' }, { id: 'c', text: '(c) Ponerle una multa directamente.' }, { id: 'd', text: '(d) Mover el veh√≠culo a la zona de visitantes.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. No se deben ignorar las irregularidades en el parqueadero.", 'b': "¬°Correcto! El Art. 52 exige ficheros actualizados y obligatorios. La acci√≥n correcta es verificar la autorizaci√≥n usando la base de datos y actuar seg√∫n el resultado (recordar o informar novedad).", 'c': "Incorrecto. El manual no menciona multas, sino control y reporte.", 'd': "Incorrecto. No se debe mover un veh√≠culo sin autorizaci√≥n o sin seguir un procedimiento establecido para esos casos." } },
                     { id: 2, title: 'Escenario 2: Pernocta no Autorizada', icon: '<span>&#127769;</span><span class="mx-2">&#128663;</span><span>&#10060;</span>', color: 'text-red-600', text: 'Son las 20:00 hrs. Al verificar el parqueadero, encuentra un veh√≠culo particular que, seg√∫n la base de datos, pertenece a un visitante que deb√≠a retirarse a las 17:00 hrs. No hay reporte de que el visitante siga en la instalaci√≥n. ¬øQu√© debe hacer?', options: [ { id: 'a', text: '(a) Dejar el veh√≠culo, quiz√°s el visitante sali√≥ tarde y olvid√≥ informar.' }, { id: 'b', text: '(b) Intentar contactar al visitante usando los datos del registro. Si no es posible, informar la novedad al superior (Comandante de Guardia/Jefe de Seguridad) para determinar acciones.' }, { id: 'c', text: '(c) Inmovilizar el veh√≠culo con un cepo.' }, { id: 'd', text: '(d) Asumir que obtuvo permiso y no hacer nada.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. El Art. 52 proh√≠be la pernocta no autorizada y exige verificaci√≥n a las 19:00.", 'b': "¬°Correcto! Se debe intentar contactar al responsable usando la informaci√≥n registrada y, si no es posible o no hay justificaci√≥n, escalar la novedad al superior para que se tomen las medidas correspondientes.", 'c': "Incorrecto. El manual no menciona el uso de cepos como procedimiento est√°ndar.", 'd': "Incorrecto. No se deben asumir permisos; la pernocta no autorizada es una novedad que requiere acci√≥n." } }
                ],
                 summaryPoints: [ 'La <strong>distribuci√≥n y demarcaci√≥n</strong> del parqueadero facilitan el control (Art. 52).', 'El <strong>personal de seguridad</strong> verifica el parqueo correcto y el uso de <strong>fichas</strong> (Art. 52).', 'Se debe mantener una <strong>base de datos actualizada</strong> y controlar la <strong>pernocta</strong> no autorizada (Art. 52).', 'Existen normas de <strong>circulaci√≥n (velocidad, luces)</strong> y se recomienda <strong>iluminaci√≥n y CCTV</strong> (Art. 52).', 'Realizar <strong>inspecciones peri√≥dicas</strong> (si hay binomios) y recordar no dejar objetos de valor (Art. 52).' ]
            }
        ];

        // --- L√≥gica de la Aplicaci√≥n (sin cambios) ---
        let currentModuleId = null;
        let currentStep = 1;
        let currentScenario = 1;
        let currentModuleData = {};

        // Funciones auxiliares
        function showElement(id) {
            const el = document.getElementById(id);
            if (el) el.style.display = 'block';
        }

        function hideElement(id) {
             const el = document.getElementById(id);
            if (el) el.style.display = 'none';
        }

        function clearContainer(containerId) {
            const container = document.getElementById(containerId);
            if (container) container.innerHTML = '';
        }

        // Inicializaci√≥n del Men√∫ Principal
        function initializeMainMenu() {
            const menuContainer = document.getElementById('menu-cards-container'); // Cambiado a cards container
            clearContainer('menu-cards-container'); // Limpiar por si acaso
            modulesData.forEach(module => {
                const card = document.createElement('div');
                card.className = 'menu-card';
                card.onclick = () => loadModule(module.id);
                card.innerHTML = `
                    <div class="menu-card-icon">${module.menuIcon || '‚ùì'}</div>
                    <h3 class="menu-card-title">${module.title}</h3>
                    <p class="menu-card-subtitle">${module.subtitle}</p>
                `;
                menuContainer.appendChild(card);
            });
            showElement('main-menu');
            hideElement('active-module');
        }

        // Cargar un M√≥dulo
        function loadModule(moduleId) {
            currentModuleId = moduleId;
            currentModuleData = modulesData.find(m => m.id === moduleId);
            if (!currentModuleData) return; // M√≥dulo no encontrado

            // Ocultar men√∫ y mostrar contenedor del m√≥dulo
            hideElement('main-menu');
            showElement('active-module');

            // Resetear vistas internas del m√≥dulo
            hideElement('protocolo');
            hideElement('escenarios');
            hideElement('resumen');
            hideElement('verification-question');

            // Llenar t√≠tulos
            document.getElementById('module-title').textContent = currentModuleData.title; // Usar t√≠tulo corto si se defini√≥ para card, o el largo
            document.getElementById('module-subtitle').textContent = currentModuleData.subtitle;

            // Construir secci√≥n de protocolo
            buildProtocolSection();

            // Construir secci√≥n de escenarios (se oculta inicialmente)
            buildScenariosSection();

            // Construir secci√≥n de resumen (se oculta inicialmente)
            buildSummarySection();

            // Iniciar mostrando la secci√≥n de protocolo
            showElement('protocolo');
            currentStep = 1;
            setActiveStep(currentStep);
        }

        // Construir Secci√≥n de Protocolo
        function buildProtocolSection() {
            const stepsContainer = document.getElementById('protocol-steps-container');
            clearContainer('protocol-steps-container');
            const totalSteps = currentModuleData.protocolSteps.length;

            currentModuleData.protocolSteps.forEach((step, index) => {
                const stepNumber = index + 1;
                const stepDiv = document.createElement('div');
                stepDiv.id = `step-${stepNumber}`;
                stepDiv.className = 'step-content mb-6 p-4 border rounded-lg bg-gray-50';

                stepDiv.innerHTML = `
                    <h4 class="font-bold text-lg mb-2 text-gray-700">${step.title}</h4>
                    <div class="flex items-center text-2xl ${step.color || 'text-gray-500'} mb-3">
                        ${step.icon || ''}
                    </div>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        ${step.points.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                    <div class="mt-4 flex justify-between">
                        <button onclick="prevStep(${stepNumber - 1})" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-1 px-4 rounded transition duration-200 text-sm ${stepNumber === 1 ? 'invisible' : ''}">Anterior</button>
                        ${stepNumber === totalSteps
                            ? `<button onclick="showVerificationQuestion()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-4 rounded transition duration-200 text-sm">Verificar Comprensi√≥n</button>`
                            : `<button onclick="nextStep(${stepNumber + 1})" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1 px-4 rounded transition duration-200 text-sm">Siguiente</button>`
                        }
                    </div>
                `;
                stepsContainer.appendChild(stepDiv);
            });

            // Construir pregunta de verificaci√≥n
            const vq = currentModuleData.verificationQuestion;
            document.getElementById('verification-question-text').textContent = vq.text;
            const vqOptionsContainer = document.getElementById('verification-options-container');
            clearContainer('verification-options-container');
            vq.options.forEach(opt => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = opt.text;
                button.onclick = () => checkVerificationAnswer(opt.correct, button);
                vqOptionsContainer.appendChild(button);
            });
             // Limpiar feedback anterior
            const vqFeedback = document.getElementById('verification-feedback');
            vqFeedback.style.display = 'none';
            vqFeedback.textContent = '';
            vqFeedback.className = 'feedback';
             document.getElementById('start-scenarios-btn').style.display = 'none'; // Ocultar bot√≥n de iniciar escenarios

        }

        // Construir Secci√≥n de Escenarios
        function buildScenariosSection() {
            const scenariosContainer = document.getElementById('scenarios-container');
            clearContainer('scenarios-container');
            if (!currentModuleData.scenarios || currentModuleData.scenarios.length === 0) {
                // Manejar caso sin escenarios (opcional)
                 scenariosContainer.innerHTML = '<p class="text-gray-500 text-center italic my-6">No hay escenarios de pr√°ctica disponibles para este m√≥dulo.</p>';
                 // Ir directo al resumen si no hay escenarios
                 setTimeout(showSummary, 1500); // Ir al resumen tras 1.5 segundos si no hay escenarios
                return;
            }
            const totalScenarios = currentModuleData.scenarios.length;


            currentModuleData.scenarios.forEach((scenario, index) => {
                const scenarioNumber = index + 1;
                const scenarioDiv = document.createElement('div');
                scenarioDiv.id = `scenario-${scenarioNumber}`;
                scenarioDiv.className = 'scenario-content p-4 border rounded-lg bg-gray-50 mb-6';

                scenarioDiv.innerHTML = `
                    <h4 class="font-bold text-lg mb-2 text-gray-700">${scenario.title}</h4>
                    <div class="flex items-center text-2xl ${scenario.color || 'text-gray-500'} mb-3">
                        ${scenario.icon || ''}
                    </div>
                    <p class="text-gray-700 mb-4">${scenario.text}</p>
                    <div id="options-scenario-${scenarioNumber}">
                        ${scenario.options.map(opt => `<button class="option-button" onclick="checkScenarioAnswer(${scenarioNumber}, '${opt.id}', this)">${opt.text}</button>`).join('')}
                    </div>
                    <div id="feedback-scenario-${scenarioNumber}" class="feedback"></div>
                    <div class="mt-4 text-right">
                        ${scenarioNumber === totalScenarios
                            ? `<button id="next-scenario-${scenarioNumber}" onclick="showSummary()" style="display:none;" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-4 rounded transition duration-200 text-sm">Ver Resumen</button>`
                            : `<button id="next-scenario-${scenarioNumber}" onclick="nextScenario(${scenarioNumber + 1})" style="display:none;" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1 px-4 rounded transition duration-200 text-sm">Siguiente Escenario</button>`
                        }
                    </div>
                `;
                scenariosContainer.appendChild(scenarioDiv);
                 // Limpiar feedback anterior
                const feedbackEl = document.getElementById(`feedback-scenario-${scenarioNumber}`);
                 feedbackEl.style.display = 'none';
                 feedbackEl.textContent = '';
                 feedbackEl.className = 'feedback';
                 // Ocultar bot√≥n siguiente
                  const nextButton = document.getElementById(`next-scenario-${scenarioNumber}`);
                  if(nextButton) nextButton.style.display = 'none';

            });
        }

        // Construir Secci√≥n de Resumen
        function buildSummarySection() {
            const summaryPointsList = document.getElementById('summary-points');
            clearContainer('summary-points');
             if (!currentModuleData.summaryPoints || currentModuleData.summaryPoints.length === 0) {
                 summaryPointsList.innerHTML = '<li class="text-gray-500 italic">Resumen no disponible.</li>';
                 return;
             }
            currentModuleData.summaryPoints.forEach(point => {
                const li = document.createElement('li');
                li.innerHTML = point; // Usar innerHTML para permitir etiquetas como <strong>
                summaryPointsList.appendChild(li);
            });
        }


        // --- Funciones de Navegaci√≥n y L√≥gica ---

        function setActiveStep(stepNumber) {
            document.querySelectorAll(`#protocol-steps-container .step-content`).forEach(el => el.classList.remove('active'));
            const currentStepElement = document.getElementById(`step-${stepNumber}`);
            if (currentStepElement) {
                currentStepElement.classList.add('active');
            }
        }

         function nextStep(stepNumber) {
             const totalSteps = currentModuleData.protocolSteps.length;
            if (stepNumber <= totalSteps) {
                currentStep = stepNumber;
                setActiveStep(currentStep);
            }
        }

        function prevStep(stepNumber) {
             if (stepNumber >= 1) {
                currentStep = stepNumber;
                setActiveStep(currentStep);
            }
        }

        function showVerificationQuestion() {
            const totalSteps = currentModuleData.protocolSteps.length;
            hideElement(`step-${totalSteps}`);
            showElement('verification-question');
             // Resetear botones de la pregunta
            const vqOptionsContainer = document.getElementById('verification-options-container');
            vqOptionsContainer.querySelectorAll('.option-button').forEach(btn => {
                btn.disabled = false;
                btn.className = 'option-button';
            });
             // Ocultar feedback y bot√≥n de escenarios
            hideElement('verification-feedback');
            hideElement('start-scenarios-btn');
        }

        function checkVerificationAnswer(isCorrect, buttonElement) {
            const feedbackEl = document.getElementById('verification-feedback');
            const allButtons = document.querySelectorAll('#verification-options-container .option-button');
            const vq = currentModuleData.verificationQuestion;

            allButtons.forEach(btn => { btn.disabled = true; btn.classList.remove('selected'); });
            buttonElement.classList.add('selected');

            if (isCorrect) {
                feedbackEl.textContent = vq.feedbackCorrect;
                feedbackEl.className = 'feedback correct';
                showElement('start-scenarios-btn');
                buttonElement.classList.add('correct-answer');
            } else {
                feedbackEl.textContent = vq.feedbackIncorrect;
                feedbackEl.className = 'feedback incorrect';
                allButtons.forEach(btn => {
                    // Encuentra el bot√≥n correcto para resaltarlo
                    const optionData = vq.options.find(opt => opt.text === btn.textContent);
                    if (optionData && optionData.correct) {
                        btn.classList.add('correct-answer');
                    }
                });
                 buttonElement.classList.add('incorrect-answer');
            }
            feedbackEl.style.display = 'block';
        }


        function startScenarios() {
             if (!currentModuleData.scenarios || currentModuleData.scenarios.length === 0) {
                 // Si no hay escenarios, ir directo al resumen
                 hideElement('protocolo');
                 showSummary();
             } else {
                hideElement('protocolo');
                showElement('escenarios');
                currentScenario = 1;
                setActiveScenario(currentScenario);
             }
        }

         function setActiveScenario(scenarioNumber) {
            document.querySelectorAll(`#scenarios-container .scenario-content`).forEach(el => el.classList.remove('active'));
            const currentScenarioElement = document.getElementById(`scenario-${scenarioNumber}`);
            if (currentScenarioElement) {
                currentScenarioElement.classList.add('active');
                 // Resetear botones del escenario actual
                 currentScenarioElement.querySelectorAll('.option-button').forEach(btn => {
                     btn.disabled = false;
                     btn.className = 'option-button';
                 });
                 // Ocultar feedback y bot√≥n siguiente
                 const feedbackEl = document.getElementById(`feedback-scenario-${scenarioNumber}`);
                 if(feedbackEl) feedbackEl.style.display = 'none';
                 const nextButton = document.getElementById(`next-scenario-${scenarioNumber}`);
                 if(nextButton) nextButton.style.display = 'none';
            }
        }

        function checkScenarioAnswer(scenarioNum, selectedOptionId, buttonElement) {
            const scenarioData = currentModuleData.scenarios.find(s => s.id === scenarioNum);
            if (!scenarioData) return;

            const correctAnswerId = scenarioData.correctAnswer;
            const feedback = scenarioData.feedback[selectedOptionId];
            const feedbackEl = document.getElementById(`feedback-scenario-${scenarioNum}`);
            const nextButton = document.getElementById(`next-scenario-${scenarioNum}`);
            const allButtons = document.querySelectorAll(`#scenario-${scenarioNum} .option-button`);

            allButtons.forEach(btn => { btn.disabled = true; btn.classList.remove('selected'); });
            buttonElement.classList.add('selected');

            feedbackEl.textContent = feedback;

            if (selectedOptionId === correctAnswerId) {
                feedbackEl.className = 'feedback correct';
                buttonElement.classList.add('correct-answer');
            } else {
                feedbackEl.className = 'feedback incorrect';
                buttonElement.classList.add('incorrect-answer');
                allButtons.forEach(btn => {
                    // Encuentra el bot√≥n correcto para resaltarlo
                    const optionData = scenarioData.options.find(opt => opt.text === btn.textContent);
                     if (optionData && optionData.id === correctAnswerId) {
                         btn.classList.add('correct-answer');
                     }
                });
            }
            feedbackEl.style.display = 'block';
            if (nextButton) {
                 nextButton.style.display = 'inline-block';
            }
        }

         function nextScenario(scenarioNumber) {
            const totalScenarios = currentModuleData.scenarios.length;
            if (scenarioNumber <= totalScenarios) {
                currentScenario = scenarioNumber;
                setActiveScenario(currentScenario);
            }
        }

        function showSummary() {
            hideElement('escenarios');
             hideElement('protocolo'); // Asegurarse de ocultar protocolo si se salta a resumen
            showElement('resumen');
        }

        function restartCurrentModule() {
             if(currentModuleId) {
                 loadModule(currentModuleId); // Recarga el m√≥dulo actual desde el principio
             }
        }

         function goToMainMenu() {
             hideElement('active-module');
             showElement('main-menu');
             currentModuleId = null;
             currentModuleData = {};
             // Asegurarse de que el men√∫ se reinicialice por si acaso
             initializeMainMenu();
         }

        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', initializeMainMenu);

    </script>

</body>
</html>
