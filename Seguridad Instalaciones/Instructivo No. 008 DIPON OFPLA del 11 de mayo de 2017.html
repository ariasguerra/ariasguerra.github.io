<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrenamiento Interactivo: Seguridad Personal (Inst. 008)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos generales y específicos (similares a la versión anterior) */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        #app-container {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 8px 20px -4px rgba(0, 0, 0, 0.06), 0 6px 10px -4px rgba(0, 0, 0, 0.05);
        }
        h1, h2, h3, h4 {
             color: #212529;
        }
        h2.text-blue-700 {
            color: #0056b3; /* Azul principal */
        }
        .module-content { display: none; position: relative; }
        .step-content, .scenario-content { display: none; }
        .step-content.active, .scenario-content.active { display: block; }

        .feedback { display: none; margin-top: 1rem; padding: 0.875rem 1rem; border-radius: 0.5rem; font-size: 0.9rem; border-width: 1px; }
        .feedback.correct { background-color: #e6f4ea; border-color: #28a745; color: #155724; }
        .feedback.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }

        .option-button {
            display: block; width: 100%; text-align: left; margin-top: 0.75rem; padding: 0.875rem 1.25rem;
            border: 1px solid #ced4da; border-radius: 0.5rem; background-color: #ffffff;
            color: #495057; font-weight: 500;
            transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s; cursor: pointer;
        }
        .option-button:hover:not(:disabled) {
            background-color: #f8f9fa; border-color: #adb5bd;
        }
         .option-button:disabled { cursor: not-allowed; opacity: 0.75; }
        .option-button.selected {
             border-color: #007bff; background-color: #e7f3ff;
             font-weight: 600; color: #004085;
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
         .option-button.correct-answer {
             border-color: #28a745; background-color: #d4edda; color: #155724;
         }
         .option-button.incorrect-answer {
             border-color: #dc3545; background-color: #f8d7da; color: #721c24;
         }

         /* Estilo para las fichas del menú principal */
         .menu-card {
             display: flex; flex-direction: column; align-items: center;
             padding: 1.5rem; margin-bottom: 1rem; border: 1px solid #dee2e6;
             border-radius: 0.75rem; background-color: #ffffff;
             text-align: center; cursor: pointer;
             transition: background-color 0.2s, box-shadow 0.3s, transform 0.2s; height: 100%;
             box-shadow: 0 2px 4px rgba(0,0,0,0.05);
         }
         .menu-card:hover {
             background-color: #f8f9fa;
             box-shadow: 0 5px 15px rgba(0,0,0,0.08);
             transform: translateY(-3px);
         }
         .menu-card-icon {
             font-size: 2.5rem; margin-bottom: 1rem; color: #0056b3;
             background-color: #e7f3ff; padding: 0.75rem; border-radius: 50%;
             width: 60px; height: 60px; display: inline-flex; align-items: center; justify-content: center;
         }
         .menu-card-icon svg { width: 100%; height: 100%; }
         .menu-card-title {
             font-weight: 600; color: #343a40; font-size: 1rem; margin-bottom: 0.25rem;
         }
         .menu-card-subtitle { font-size: 0.875rem; color: #6c757d; }

         /* Ajuste para listas dentro de pasos */
         .step-content ul { padding-left: 1.5rem; margin-top: 0.5rem; }
         .step-content ul li { margin-bottom: 0.4rem; line-height: 1.5; }

         /* Botones de navegación */
         .nav-button {
             font-weight: 600; padding: 0.6rem 1.5rem; border-radius: 0.5rem; transition: background-color 0.2s, transform 0.1s;
             box-shadow: 0 1px 2px rgba(0,0,0,0.05);
         }
         .nav-button:hover { transform: scale(1.03); box-shadow: 0 2px 4px rgba(0,0,0,0.07); }
         .nav-button.primary { background-color: #007bff; color: white; }
         .nav-button.primary:hover { background-color: #0056b3; }
         .nav-button.secondary { background-color: #6c757d; color: white; }
         .nav-button.secondary:hover { background-color: #5a6268; }
         .nav-button.success { background-color: #28a745; color: white; }
         .nav-button.success:hover { background-color: #218838; }

         /* Botón Volver al Menú */
        .back-to-menu-btn {
            position: absolute; top: 1.5rem; right: 1.5rem;
            background-color: #e9ecef; color: #495057;
            font-size: 0.8rem; font-weight: 500; padding: 0.3rem 0.8rem; border-radius: 9999px;
            transition: background-color 0.2s, color 0.2s; z-index: 10; border: 1px solid #dee2e6;
        }
        .back-to-menu-btn:hover { background-color: #dee2e6; color: #343a40; }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div id="app-container" class="max-w-5xl mx-auto bg-white rounded-lg shadow-xl p-6 md:p-10">

        <div id="main-menu" class="text-center">
            <h1 class="text-2xl md:text-3xl font-bold mb-4">Centro de Entrenamiento Interactivo</h1>
            <h2 class="text-xl md:text-2xl font-semibold text-blue-700 mb-8">Seguridad Personal (Inst. 008/2017)</h2>
            <p class="text-gray-600 mb-8">Selecciona el tema que deseas practicar:</p>
            <div id="menu-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"> </div>
        </div>

        <div id="active-module" class="module-content">
             <button onclick="goToMainMenu()" class="back-to-menu-btn">
                &larr; Volver al Menú
            </button>
            <h1 id="module-title" class="text-2xl md:text-3xl font-bold mb-1 pt-8 md:pt-0"></h1>
            <h2 id="module-subtitle" class="text-lg md:text-xl font-semibold text-blue-700 mb-6"></h2>

            <div id="protocolo" style="display: none;">
                <h3 class="text-xl font-semibold mb-4 border-b pb-2">Recomendaciones Clave</h3>
                <div id="protocol-steps-container"></div>
                <div id="verification-question" style="display: none;" class="mt-6 p-5 border rounded-lg bg-blue-50">
                     <h4 class="font-bold text-lg mb-3 text-blue-800">¡Verifica tu Comprensión!</h4>
                     <p id="verification-question-text" class="mb-4 text-gray-700 font-medium"></p>
                     <div id="verification-options-container"></div>
                     <div id="verification-feedback" class="feedback"></div>
                     <div class="mt-6 text-center">
                        <button id="start-scenarios-btn" onclick="startScenarios()" style="display:none;" class="nav-button success">
                            Iniciar Escenarios Simulados
                        </button>
                     </div>
                </div>
            </div>

            <div id="escenarios" style="display: none;">
                <h3 class="text-xl font-semibold mb-4 border-b pb-2">Escenarios Simulados</h3>
                <div id="scenarios-container"></div>
            </div>

            <div id="resumen" style="display: none;" class="p-6 border rounded-lg bg-blue-50 text-center">
                <h3 class="text-xl font-semibold text-blue-700 mb-4">Resumen del Módulo</h3>
                 <div id="summary-icon" class="flex justify-center space-x-4 my-5 text-4xl text-green-600">
                    <span>&#127941;</span>
                 </div>
                <p class="text-gray-800 mb-4 font-semibold text-lg">¡Felicidades por completar el módulo!</p>
                <p class="font-medium mb-3 text-gray-700">Puntos Clave Recordados:</p>
                <ul id="summary-points" class="list-disc list-inside text-gray-600 space-y-1 mb-8 text-left inline-block"></ul>
                 <div class="flex justify-center space-x-4">
                    <button onclick="restartCurrentModule()" class="nav-button secondary">
                        Reiniciar Módulo
                    </button>
                     <button onclick="goToMainMenu()" class="nav-button primary">
                        Menú Principal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Iconos SVG ---
        const svgIcons = {
            desplazamiento: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0c-.563.058-.987.538-.987 1.106v.958m12.026 0h-2.25m0-3.182.08-.056a48.554 48.554 0 0 1 10.026 0 .08.056m-12.026 0h-2.25" /></svg>`,
            vigilancia: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>`, // Ojo
            tecnologia: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" /></svg>`, // Celular
            servicio: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" /></svg>`, // Escudo
        };

        // --- Definición de Datos de los Módulos (Basado en Instructivo 008) ---
        const modulesData = [
            {
                id: 'desplazamientos_vehiculos',
                title: 'Desplazamientos y Vehículos',
                menuIcon: svgIcons.desplazamiento,
                subtitle: 'Seguridad Personal',
                protocolSteps: [
                    { title: 'Recomendación 1: Parqueo Seguro', icon: '🅿️', color: 'text-blue-600', points: ['Parquear vehículos policiales ÚNICAMENTE en instalaciones de unidades de Policía.'] },
                    { title: 'Recomendación 2: Rutas Alternas', icon: '🔄', color: 'text-green-600', points: ['Utilizar rutas alternas para desplazamientos (residencia <-> trabajo).', 'Evitar la rutina.'] },
                    { title: 'Recomendación 3: No Uniforme en Desplazamientos', icon: '👕', color: 'text-red-600', points: ['ABSTENERSE de realizar desplazamientos con uniforme en vehículos propios o transporte público.', 'Evitar portar uniforme para actividades particulares.'] },
                    { title: 'Recomendación 4: Mantenimiento Armamento', icon: '🔧', color: 'text-orange-600', points: ['Realizar mantenimiento preventivo y correctivo del armamento.', 'Prever material de contingencia en óptimo estado.'] }
                ],
                 verificationQuestion: {
                    text: '¿Dónde se deben parquear los vehículos policiales según el Instructivo 008?',
                    options: [ { text: 'En cualquier parqueadero vigilado.', correct: false }, { text: 'Únicamente en instalaciones de unidades de Policía.', correct: true }, { text: 'Cerca al lugar de residencia del funcionario.', correct: false } ],
                    feedbackCorrect: '¡Correcto! El instructivo es específico: únicamente en instalaciones policiales.',
                    feedbackIncorrect: 'Incorrecto. Revisa el instructivo. El parqueo debe ser en instalaciones policiales.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Uniforme en Bus', icon: '🚌', color: 'text-red-600', text: 'Un patrullero termina su turno y decide irse a su casa en transporte público portando el uniforme completo para "ahorrar tiempo". ¿Es recomendable esta acción?', options: [ { id: 'a', text: '(a) Sí, es práctico y demuestra presencia policial.' }, { id: 'b', text: '(b) No, el instructivo recomienda abstenerse de usar uniforme en transporte público por seguridad personal.' }, { id: 'c', text: '(c) Solo si el bus no va muy lleno.' }, { id: 'd', text: '(d) Sí, si no lleva el armamento de dotación.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. La practicidad no debe primar sobre la recomendación de seguridad.", 'b': "¡Correcto! El Instructivo 008 recomienda explícitamente abstenerse de usar uniforme en transporte público.", 'c': "Incorrecto. La recomendación no depende de la ocupación del bus.", 'd': "Incorrecto. La recomendación es sobre el uniforme, independientemente del armamento." } }
                ],
                 summaryPoints: [ 'Parquear vehículos policiales <strong>solo en instalaciones policiales</strong>.', 'Usar <strong>rutas alternas</strong> para evitar rutina.', '<strong>No usar uniforme</strong> en desplazamientos personales (vehículo propio/transporte público).', 'Mantener <strong>armamento</strong> con mantenimiento y prever contingencia.' ]
            },
            {
                id: 'entorno_vigilancia',
                title: 'Entorno y Vigilancia',
                menuIcon: svgIcons.vigilancia,
                subtitle: 'Seguridad Personal',
                protocolSteps: [
                    { title: 'Recomendación 1: Atención y Defensa', icon: '👀', color: 'text-orange-600', points: ['Estar atentos y a la defensiva.', 'Verificar en alrededores: factores, personas, objetos sospechosos.'] },
                    { title: 'Recomendación 2: Redes de Apoyo', icon: '🏘️', color: 'text-blue-600', points: ['Mantener comunicación con residentes cercanos (vivienda).', 'Pueden transmitir datos sobre personas extrañas/vehículos sospechosos.', 'Fortalecer programas participación ciudadana y Red de Apoyo y Solidaridad.', 'Incrementar recolección información para anticipar ataques.'] },
                    { title: 'Recomendación 3: Inspección del Entorno (Servicio)', icon: '🔍', color: 'text-green-600', points: ['Durante el servicio, realizar inspección detallada del entorno.', 'Identificar personas u objetos sospechosos.', 'Prevenir abandono/activación de explosivos.'] },
                    { title: 'Recomendación 4: Evitar Rutina (General)', icon: '🔄', color: 'text-red-600', points: ['Analizar lugares de mayor vulnerabilidad y horarios.', 'Insistir en EVITAR CAER EN LA RUTINA.', 'Mantener siempre actitud alerta (en servicio y fuera de él).'] }
                ],
                 verificationQuestion: {
                    text: '¿Por qué es importante mantener comunicación con los vecinos cerca al lugar de residencia?',
                    options: [ { text: 'Para socializar únicamente.', correct: false }, { text: 'Porque pueden transmitir información relevante sobre personas o vehículos sospechosos.', correct: true }, { text: 'Para organizar eventos comunitarios.', correct: false } ],
                    feedbackCorrect: '¡Correcto! El instructivo lo menciona como una fuente de información valiosa para la seguridad personal.',
                    feedbackIncorrect: 'Incorrecto. Si bien socializar es bueno, el instructivo enfoca la comunicación con vecinos en la obtención de información de seguridad.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Siempre la Misma Tienda', icon: '🛒', color: 'text-red-600', text: 'Un uniformado, al salir de turno, pasa todos los días a la misma hora por la misma tienda a comprar algo antes de ir a casa. ¿Qué recomendación de seguridad está ignorando?', options: [ { id: 'a', text: '(a) La de parquear en instalaciones policiales.' }, { id: 'b', text: '(b) La de evitar la rutina y mantener actitud alerta fuera del servicio.' }, { id: 'c', text: '(c) La de no usar prendas institucionales.' }, { id: 'd', text: '(d) La de fortalecer redes de apoyo.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto.", 'b': "¡Correcto! Ir siempre al mismo lugar a la misma hora constituye una rutina que facilita la observación criminal. El instructivo insiste en evitarla y mantener actitud alerta fuera de servicio.", 'c': "Incorrecto (aunque podría ser relevante si lleva prendas).", 'd': "Incorrecto." } },
                     { id: 2, title: 'Escenario 2: Persona Sospechosa', icon: '🕵️', color: 'text-orange-600', text: 'Durante el patrullaje, nota a una persona que parece observar detenidamente la estación de policía desde la esquina opuesta durante varios minutos, simulando hablar por teléfono. ¿Qué acción inmediata sugiere el instructivo?', options: [ { id: 'a', text: '(a) Ignorarlo, puede ser casualidad.' }, { id: 'b', text: '(b) Acercarse directamente y confrontarlo.' }, { id: 'c', text: '(c) Estar atento y a la defensiva, verificar la situación (posiblemente con apoyo y manteniendo distancia inicial) por ser una actitud sospechosa cerca a la instalación.' }, { id: 'd', text: '(d) Tomarle una foto con el celular.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto. La observación persistente a instalaciones es una señal de alerta.", 'b': "Incorrecto. La confrontación directa e inmediata puede ser riesgosa; se debe evaluar y actuar tácticamente.", 'c': "¡Correcto! El instructivo pide estar atentos y a la defensiva, verificando personas sospechosas en los alrededores. La acción debe ser prudente y táctica.", 'd': "Incorrecto. Usar el celular puede ser un distractor y la acción inicial debe ser de alerta y verificación táctica." } }
                ],
                 summaryPoints: [ 'Estar <strong>atentos y a la defensiva</strong>, verificando alrededores.', 'Fomentar <strong>redes de apoyo</strong> con vecinos y comunidad.', 'Realizar <strong>inspección detallada</strong> del entorno en servicio.', '<strong>¡EVITAR LA RUTINA!</strong> en horarios y lugares.', 'Mantener <strong>actitud alerta</strong> siempre (en servicio y fuera de él).' ]
            },
            {
                id: 'info_tecnologia',
                title: 'Manejo Información y Tecnología',
                menuIcon: svgIcons.tecnologia,
                subtitle: 'Seguridad Personal',
                protocolSteps: [
                    { title: 'Recomendación 1: Prendas y Símbolos', icon: '🚫', color: 'text-red-600', points: ['Procurar NO llevar consigo prendas (gorras, camisetas, etc.) con símbolos alusivos a la Institución fuera de actos del servicio.'] },
                    { title: 'Recomendación 2: Redes Sociales', icon: '📱', color: 'text-orange-600', points: ['Evitar publicar datos personales y de familiares en redes sociales o internet.', 'Ser consciente de la exposición y riesgos asociados.'] },
                    { title: 'Recomendación 3: Uso de Celular/Distractores', icon: '📵', color: 'text-red-600', points: ['NO utilizar celulares, medios electrónicos u otros distractores DURANTE el servicio.', '(Remite al Instructivo 044 de 2010, aunque el 012 de 2020 es más reciente y específico).', 'Desvían la atención e incrementan vulnerabilidades.'] }
                ],
                 verificationQuestion: {
                    text: '¿Qué recomendación da el Instructivo 008 sobre publicar datos personales en redes sociales?',
                    options: [ { text: 'Publicar solo a amigos cercanos.', correct: false }, { text: 'Evitar publicar datos personales y de familiares.', correct: true }, { text: 'Publicar solo el rango y unidad.', correct: false } ],
                    feedbackCorrect: '¡Correcto! El instructivo recomienda evitar publicar esta información para proteger la seguridad personal y familiar.',
                    feedbackIncorrect: 'Incorrecto. Revisa el instructivo. La recomendación es evitar la publicación de datos personales y familiares.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Chaqueta Institucional', icon: '🧥', color: 'text-red-600', text: 'Un policía sale de permiso y viaja a otra ciudad usando una chaqueta con el escudo de la Policía Nacional bien visible. ¿Se ajusta esta acción a las recomendaciones del instructivo?', options: [ { id: 'a', text: '(a) Sí, demuestra orgullo institucional.' }, { id: 'b', text: '(b) No, el instructivo procura evitar llevar prendas con símbolos alusivos fuera del servicio.' }, { id: 'c', text: '(c) Solo si viaja en vehículo particular.' }, { id: 'd', text: '(d) Sí, si no está en una zona de riesgo.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. El orgullo institucional no debe comprometer la seguridad personal.", 'b': "¡Correcto! El Instructivo 008 recomienda procurar no llevar prendas con símbolos institucionales fuera de actos del servicio.", 'c': "Incorrecto. La recomendación no distingue el medio de transporte.", 'd': "Incorrecto. La recomendación es general para minimizar la identificación innecesaria." } },
                     { id: 2, title: 'Escenario 2: Celular en Punto Fijo', icon: '📱', color: 'text-red-600', text: 'Un centinela en un puesto de guardia fijo está revisando su teléfono celular mientras está de servicio. ¿Qué indica el Instructivo 008 al respecto?', options: [ { id: 'a', text: '(a) Que puede hacerlo si no hay novedades.' }, { id: 'b', text: '(b) Que no debe utilizar celulares u otros distractores durante el servicio.' }, { id: 'c', text: '(c) Que debe pedir permiso a su superior.' }, { id: 'd', text: '(d) Que solo puede usarlo para llamadas de emergencia.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto. La atención debe ser constante.", 'b': "¡Correcto! El Instructivo 008 (y el más reciente 012) prohíben el uso de celulares y distractores durante el servicio por desviar la atención e incrementar vulnerabilidades.", 'c': "Incorrecto. La prohibición es general durante el servicio.", 'd': "Incorrecto. Aunque una emergencia real podría justificarlo brevemente, la norma es no usarlo como distractor." } }
                ],
                 summaryPoints: [ 'Evitar usar <strong>prendas con símbolos</strong> institucionales fuera de servicio.', 'No publicar <strong>datos personales/familiares</strong> en redes sociales.', '<strong>NO usar celular/distractores</strong> durante el servicio.' ]
            },
            {
                id: 'actuacion_servicio',
                title: 'Actuación en Servicio',
                menuIcon: svgIcons.servicio,
                subtitle: 'Seguridad Personal',
                protocolSteps: [
                    { title: 'Recomendación 1: Trabajo en Equipo', icon: '👥', color: 'text-blue-600', points: ['Fomentar trabajo en equipo (seguridad personal/interpersonal).', 'Crear confianza, fraternidad, solidaridad.', 'Asignar responsabilidades.', 'Actuar en grupo para mejorar atención y eficiencia.'] },
                    { title: 'Recomendación 2: Comunicación Constante', icon: '📡', color: 'text-green-600', points: ['Mantener comunicación permanente con NUSE/CAD/Salas Radio al proceder policialmente.', 'Objetivo: Ser ubicable y apoyado oportunamente.'] },
                    { title: 'Recomendación 3: Reentrenamiento', icon: '🏋️', color: 'text-purple-600', points: ['Efectuar reentrenamientos en defensa personal.', 'Práctica de polígono (énfasis en tiro defensivo).'] },
                    { title: 'Recomendación 4: Evaluación de Riesgos (Motivos Policía)', icon: '🤔', color: 'text-orange-600', points: ['Evaluar posibles riesgos que situación conlleva.', 'Solicitar apoyo correspondiente si es necesario.', 'Tener conocimiento amplio del lugar, hora, tipo servicio.', 'Zonas rurales: Extremar medidas, labores previas inteligencia (evitar emboscadas).'] },
                    { title: 'Recomendación 5: Planes y Registros', icon: '📝', color: 'text-teal-600', points: ['Aplicar técnicas seguridad en identificación/registro a personas/vehículos (ingreso instalaciones).', 'Ejecutar planes prevención/control en lapsos cortos y con medidas seguridad.'] }
                ],
                 verificationQuestion: {
                    text: 'Al atender un motivo de policía, ¿por qué es crucial mantener comunicación permanente con la central (NUSE/CAD/Radio)?',
                    options: [ { text: 'Para reportar únicamente el cierre del caso.', correct: false }, { text: 'Para ser ubicable y poder recibir apoyo oportunamente si es necesario.', correct: true }, { text: 'Para solicitar permiso para usar el celular.', correct: false } ],
                    feedbackCorrect: '¡Correcto! El instructivo lo indica para garantizar la ubicación y la posibilidad de recibir apoyo a tiempo.',
                    feedbackIncorrect: 'Incorrecto. Revisa el instructivo. La comunicación constante es vital para la seguridad y el apoyo.'
                },
                scenarios: [
                     { id: 1, title: 'Escenario 1: Patrulla Solitaria', icon: '🚶‍♂️', color: 'text-blue-600', text: 'Un policía decide atender un llamado por escándalo en una zona compleja de la ciudad él solo, sin esperar a su compañero de patrulla que estaba ocupado brevemente. ¿Qué recomendación del instructivo está omitiendo?', options: [ { id: 'a', text: '(a) La de usar rutas alternas.' }, { id: 'b', text: '(b) La de fomentar el trabajo en equipo y actuar en grupo para mejorar la atención y seguridad.' }, { id: 'c', text: '(c) La de no usar prendas institucionales fuera de servicio.' }, { id: 'd', text: '(d) La de mantener comunicación con vecinos.' } ], correctAnswer: 'b', feedback: { 'a': "Incorrecto.", 'b': "¡Correcto! El Instructivo 008 fomenta el trabajo en equipo y actuar en grupo para mejorar la seguridad y eficiencia, especialmente al atender motivos de policía.", 'c': "Incorrecto.", 'd': "Incorrecto." } },
                     { id: 2, title: 'Escenario 2: Llamada Rural sin Verificar', icon: '📞', color: 'text-orange-600', text: 'Se recibe una llamada anónima reportando una supuesta actividad sospechosa en una vereda lejana y de difícil acceso. El comandante ordena el desplazamiento inmediato de una patrulla sin realizar verificaciones previas de inteligencia. ¿Qué riesgo principal se corre según el instructivo?', options: [ { id: 'a', text: '(a) El riesgo de gastar combustible innecesariamente.' }, { id: 'b', text: '(b) El riesgo de no llevar el uniforme adecuado.' }, { id: 'c', text: '(c) El riesgo de caer en una emboscada, al no realizar labores previas de inteligencia para confirmar hechos en zonas rurales.' }, { id: 'd', text: '(d) El riesgo de no tener buena señal de celular.' } ], correctAnswer: 'c', feedback: { 'a': "Incorrecto.", 'b': "Incorrecto.", 'c': "¡Correcto! El Instructivo 008 advierte específicamente sobre extremar medidas en zonas rurales y realizar labores previas de inteligencia para confirmar hechos y evitar emboscadas.", 'd': "Incorrecto (aunque la comunicación es importante, el riesgo principal aquí es la emboscada)." } }
                ],
                 summaryPoints: [ 'Fomentar <strong>trabajo en equipo</strong> y actuar en grupo.', 'Mantener <strong>comunicación constante</strong> con central/radio.', 'Realizar <strong>reentrenamientos</strong> (defensa personal, polígono).', '<strong>Evaluar riesgos</strong> antes de atender motivos (especialmente rural, inteligencia previa).', 'Aplicar técnicas de <strong>seguridad en registros</strong> e identificación.' ]
            }
        ];

        // --- Lógica de la Aplicación (sin cambios funcionales) ---
        let currentModuleId = null;
        let currentStep = 1;
        let currentScenario = 1;
        let currentModuleData = {};

        function showElement(id) { const el = document.getElementById(id); if (el) el.style.display = 'block'; }
        function hideElement(id) { const el = document.getElementById(id); if (el) el.style.display = 'none'; }
        function clearContainer(containerId) { const container = document.getElementById(containerId); if (container) container.innerHTML = ''; }

        function initializeMainMenu() {
            const menuContainer = document.getElementById('menu-cards-container');
            clearContainer('menu-cards-container');
            modulesData.forEach(module => {
                const card = document.createElement('div');
                card.className = 'menu-card';
                card.onclick = () => loadModule(module.id);
                card.innerHTML = `
                    <div class="menu-card-icon">${module.menuIcon || '❓'}</div>
                    <h3 class="menu-card-title">${module.title}</h3>
                    <p class="menu-card-subtitle">${module.subtitle}</p>
                `;
                menuContainer.appendChild(card);
            });
            showElement('main-menu');
            hideElement('active-module');
        }

        function loadModule(moduleId) {
            currentModuleId = moduleId;
            currentModuleData = modulesData.find(m => m.id === moduleId);
            if (!currentModuleData) return;

            hideElement('main-menu');
            showElement('active-module');
            hideElement('protocolo');
            hideElement('escenarios');
            hideElement('resumen');
            hideElement('verification-question');

            document.getElementById('module-title').textContent = currentModuleData.title;
            document.getElementById('module-subtitle').textContent = currentModuleData.subtitle;

            buildProtocolSection();
            buildScenariosSection();
            buildSummarySection();

            showElement('protocolo');
            currentStep = 1;
            setActiveStep(currentStep);
        }

        function buildProtocolSection() {
            const stepsContainer = document.getElementById('protocol-steps-container');
            clearContainer('protocol-steps-container');
            const totalSteps = currentModuleData.protocolSteps.length;

            currentModuleData.protocolSteps.forEach((step, index) => {
                const stepNumber = index + 1;
                const stepDiv = document.createElement('div');
                stepDiv.id = `step-${stepNumber}`;
                stepDiv.className = 'step-content mb-6 p-5 border rounded-lg bg-gray-50 shadow-sm';

                stepDiv.innerHTML = `
                    <h4 class="font-semibold text-lg mb-3 text-gray-700 flex items-center">
                       <span class="text-2xl mr-3 ${step.color || 'text-gray-500'}">${step.icon || ''}</span>
                       ${step.title}
                    </h4>
                    <ul class="list-disc list-inside text-gray-600 space-y-1 text-sm">
                        ${step.points.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                    <div class="mt-6 flex justify-between">
                        <button onclick="prevStep(${stepNumber - 1})" class="nav-button secondary ${stepNumber === 1 ? 'invisible' : ''}">Anterior</button>
                        ${stepNumber === totalSteps
                            ? `<button onclick="showVerificationQuestion()" class="nav-button success">Verificar Comprensión</button>`
                            : `<button onclick="nextStep(${stepNumber + 1})" class="nav-button primary">Siguiente</button>`
                        }
                    </div>
                `;
                stepsContainer.appendChild(stepDiv);
            });

            const vq = currentModuleData.verificationQuestion;
            document.getElementById('verification-question-text').textContent = vq.text;
            const vqOptionsContainer = document.getElementById('verification-options-container');
            clearContainer('verification-options-container');
            vq.options.forEach(opt => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = opt.text;
                button.onclick = () => checkVerificationAnswer(opt.correct, button);
                vqOptionsContainer.appendChild(button);
            });
            const vqFeedback = document.getElementById('verification-feedback');
            vqFeedback.style.display = 'none'; vqFeedback.textContent = ''; vqFeedback.className = 'feedback';
            document.getElementById('start-scenarios-btn').style.display = 'none';
        }

        function buildScenariosSection() {
            const scenariosContainer = document.getElementById('scenarios-container');
            clearContainer('scenarios-container');
            if (!currentModuleData.scenarios || currentModuleData.scenarios.length === 0) {
                 scenariosContainer.innerHTML = '<p class="text-gray-500 text-center italic my-6">No hay escenarios de práctica disponibles para este módulo.</p>';
                 setTimeout(showSummary, 1500);
                return;
            }
            const totalScenarios = currentModuleData.scenarios.length;

            currentModuleData.scenarios.forEach((scenario, index) => {
                const scenarioNumber = index + 1;
                const scenarioDiv = document.createElement('div');
                scenarioDiv.id = `scenario-${scenarioNumber}`;
                scenarioDiv.className = 'scenario-content p-5 border rounded-lg bg-gray-50 mb-6 shadow-sm';

                scenarioDiv.innerHTML = `
                    <h4 class="font-semibold text-lg mb-3 text-gray-700 flex items-center">
                        <span class="text-2xl mr-3 ${scenario.color || 'text-gray-500'}">${scenario.icon || ''}</span>
                        ${scenario.title}
                    </h4>
                    <p class="text-gray-600 mb-4 text-sm">${scenario.text}</p>
                    <div id="options-scenario-${scenarioNumber}">
                        ${scenario.options.map(opt => `<button class="option-button" onclick="checkScenarioAnswer(${scenarioNumber}, '${opt.id}', this)">${opt.text}</button>`).join('')}
                    </div>
                    <div id="feedback-scenario-${scenarioNumber}" class="feedback"></div>
                    <div class="mt-6 text-right">
                        ${scenarioNumber === totalScenarios
                            ? `<button id="next-scenario-${scenarioNumber}" onclick="showSummary()" style="display:none;" class="nav-button success">Ver Resumen</button>`
                            : `<button id="next-scenario-${scenarioNumber}" onclick="nextScenario(${scenarioNumber + 1})" style="display:none;" class="nav-button primary">Siguiente Escenario</button>`
                        }
                    </div>
                `;
                scenariosContainer.appendChild(scenarioDiv);
                const feedbackEl = document.getElementById(`feedback-scenario-${scenarioNumber}`);
                feedbackEl.style.display = 'none'; feedbackEl.textContent = ''; feedbackEl.className = 'feedback';
                const nextButton = document.getElementById(`next-scenario-${scenarioNumber}`);
                if(nextButton) nextButton.style.display = 'none';
            });
        }

        function buildSummarySection() {
            const summaryPointsList = document.getElementById('summary-points');
            clearContainer('summary-points');
             if (!currentModuleData.summaryPoints || currentModuleData.summaryPoints.length === 0) {
                 summaryPointsList.innerHTML = '<li class="text-gray-500 italic">Resumen no disponible.</li>';
                 return;
             }
            currentModuleData.summaryPoints.forEach(point => {
                const li = document.createElement('li');
                li.innerHTML = point;
                summaryPointsList.appendChild(li);
            });
        }

        function setActiveStep(stepNumber) { document.querySelectorAll(`#protocol-steps-container .step-content`).forEach(el => el.classList.remove('active')); const el = document.getElementById(`step-${stepNumber}`); if (el) el.classList.add('active'); }
        function nextStep(stepNumber) { const totalSteps = currentModuleData.protocolSteps.length; if (stepNumber <= totalSteps) { currentStep = stepNumber; setActiveStep(currentStep); } }
        function prevStep(stepNumber) { if (stepNumber >= 1) { currentStep = stepNumber; setActiveStep(currentStep); } }

        function showVerificationQuestion() {
            const totalSteps = currentModuleData.protocolSteps.length;
            hideElement(`step-${totalSteps}`); showElement('verification-question');
            const vqOptionsContainer = document.getElementById('verification-options-container');
            vqOptionsContainer.querySelectorAll('.option-button').forEach(btn => { btn.disabled = false; btn.className = 'option-button'; });
            hideElement('verification-feedback'); hideElement('start-scenarios-btn');
        }

        function checkVerificationAnswer(isCorrect, buttonElement) {
            const feedbackEl = document.getElementById('verification-feedback');
            const allButtons = document.querySelectorAll('#verification-options-container .option-button');
            const vq = currentModuleData.verificationQuestion;
            allButtons.forEach(btn => { btn.disabled = true; btn.classList.remove('selected', 'correct-answer', 'incorrect-answer'); });
            buttonElement.classList.add('selected');
            if (isCorrect) {
                feedbackEl.textContent = vq.feedbackCorrect; feedbackEl.className = 'feedback correct'; showElement('start-scenarios-btn'); buttonElement.classList.add('correct-answer');
            } else {
                feedbackEl.textContent = vq.feedbackIncorrect; feedbackEl.className = 'feedback incorrect';
                allButtons.forEach(btn => { const opt = vq.options.find(o => o.text === btn.textContent); if (opt && opt.correct) btn.classList.add('correct-answer'); });
                buttonElement.classList.add('incorrect-answer');
            }
            feedbackEl.style.display = 'block';
        }

        function startScenarios() {
             if (!currentModuleData.scenarios || currentModuleData.scenarios.length === 0) { hideElement('protocolo'); showSummary(); }
             else { hideElement('protocolo'); showElement('escenarios'); currentScenario = 1; setActiveScenario(currentScenario); }
        }

        function setActiveScenario(scenarioNumber) {
            document.querySelectorAll(`#scenarios-container .scenario-content`).forEach(el => el.classList.remove('active'));
            const el = document.getElementById(`scenario-${scenarioNumber}`);
            if (el) {
                el.classList.add('active');
                el.querySelectorAll('.option-button').forEach(btn => { btn.disabled = false; btn.className = 'option-button'; });
                const fb = document.getElementById(`feedback-scenario-${scenarioNumber}`); if(fb) fb.style.display = 'none';
                const nb = document.getElementById(`next-scenario-${scenarioNumber}`); if(nb) nb.style.display = 'none';
            }
        }

        function checkScenarioAnswer(scenarioNum, selectedOptionId, buttonElement) {
            const scenarioData = currentModuleData.scenarios.find(s => s.id === scenarioNum); if (!scenarioData) return;
            const correctAnswerId = scenarioData.correctAnswer; const feedback = scenarioData.feedback[selectedOptionId];
            const feedbackEl = document.getElementById(`feedback-scenario-${scenarioNum}`);
            const nextButton = document.getElementById(`next-scenario-${scenarioNum}`);
            const allButtons = document.querySelectorAll(`#scenario-${scenarioNum} .option-button`);
            allButtons.forEach(btn => { btn.disabled = true; btn.classList.remove('selected', 'correct-answer', 'incorrect-answer'); });
            buttonElement.classList.add('selected'); feedbackEl.textContent = feedback;
            if (selectedOptionId === correctAnswerId) {
                feedbackEl.className = 'feedback correct'; buttonElement.classList.add('correct-answer');
            } else {
                feedbackEl.className = 'feedback incorrect'; buttonElement.classList.add('incorrect-answer');
                allButtons.forEach(btn => { const opt = scenarioData.options.find(o => o.id === correctAnswerId); if (opt && btn.textContent === opt.text) btn.classList.add('correct-answer'); });
            }
            feedbackEl.style.display = 'block'; if (nextButton) { nextButton.style.display = 'inline-block'; }
        }

        function nextScenario(scenarioNumber) { const totalScenarios = currentModuleData.scenarios.length; if (scenarioNumber <= totalScenarios) { currentScenario = scenarioNumber; setActiveScenario(currentScenario); } }
        function showSummary() { hideElement('escenarios'); hideElement('protocolo'); showElement('resumen'); }
        function restartCurrentModule() { if(currentModuleId) { loadModule(currentModuleId); } }
        function goToMainMenu() { hideElement('active-module'); showElement('main-menu'); currentModuleId = null; currentModuleData = {}; initializeMainMenu(); }

        document.addEventListener('DOMContentLoaded', initializeMainMenu);
    </script>

<a href="https://ariasguerra.github.io/Seguridad%20Instalaciones/Index.html" 
   target="_self"
   title="Regresar al Portal Principal"
   class="fixed bottom-8 right-8 bg-blue-600 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
    </svg>
</a>
    
</body>
</html>
